<!DOCTYPE html>

<html lang="en">

<head>

<!-- Metadata -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="Seungmoon Rieh">
<meta name="keywords" content="">

<!-- Title and image -->
<title>Seungmoon Rieh</title>
<link href="/img/seungmoonrieh.jpg" rel="icon">

<!-- CSS -->
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/monokai-sublime.css" rel="stylesheet">
<link href="/css/site.css" rel="stylesheet">

<!-- JavaScript -->
<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/bootstrap.bundle.min.js" type="text/javascript"></script>
<script src="/js/highlight.pack.js" type="text/javascript"></script>
<script src="/js/include_html.js" type="text/javascript"></script>
<script src="/js/mathjax/tex-chtml.js" type="text/javascript"></script>
<script src="/js/site.js" type="text/javascript"></script>

</head>

<body>

<include src="/header.html"></include>

<div class="container">
<div class="row">
<div class="col-md-12">
<h1 class="my-4">Machine Learning</h1>

<!-- Hello Interview BEGIN -->
<div class="card mb-4" id="hello-interview">
  <div class="card-body">
    <h2 class="card-title">Hello Interview</h2>
    <ul class="list-unstyled mb-0">
      <li><a href="#hello-interview-1">Harmful Content</a></li>
      <li><a href="#hello-interview-2">Bot Detection</a></li>
    </ul>
  </div>
</div>

<div class="card mb-4" id="hello-interview-1">
  <div class="card-body">
    <h2 class="card-title">Harmful Content</h2>

    <h3 class="card-title">Problem Framing</h3>
    <ul>
      <li>Clarify the problem</li>
      <ul>
        <li>Where does potentially harmful content exist? Facebook post</li>
        <li>What does post consist of? Text and image</li>
        <li>What is considered as harmful post? violence, nudity, terrorism, human trafficking</li>
        <li>What should system do after detecting harmful content? System can remove it automatically or demote it to be reviewd by human</li>
        <li>What are consequences of false positive and false negative? FP - people will leave if system incorrectly remove their posts, so we need 95% confidence, FN - people will leave after seeing inappropriate contents</li>
        <li>How quickly should the system remove harmful posts? As soon as possible</li>
        <li>Do we have training data? Yes 25k harmful examples, 25k benign examples</li>
        <li>Should we remove harmful comments too? No, focus on post only</li>
        <li>How many posts are generated per day? 1B</li>
        <li>How common are harmful posts? Less than 1%</li>
      </ul>
      <li>Establish a business objective</li>
      <ul>
        <li>Minimize number of views on harmful contents, subject to minimum precision</li>
        <li>Minimize number of successful user reports on harmful posts </li>
      </ul>
      <li>Decide on an ML objective</li>
      <ul>
        <li>Binary classification to determine if post is harmful or not</li>
      </ul>
    </ul>

    <h3 class="card-title">High Level Design</h3>
    <img class="img-fluid" class="card-img-top" src="/machine-learning-system-design/image/mlsd-d/harmful-content-1.png" alt="Card image cap">

    <h3 class="card-title">Data and Features</h3>
    <ul>
      <li>Training data</li>
      <ul>
        <li>Supervised data</li>
        <ul>
          <li>Do 50k labeled examples contain hard cases that are prone to false positive or false negative?</li>
        </ul>
        <li>Semi-supervised data</li>
        <ul>
          <li>Use user reports for label harmful posts</li>
        </ul>
        <li>Self-supervised data</li>
        <ul>
          <li>Use user comments as heuristic to label data</li>
        </ul>
        <li>Need to address class imbalance!</li>
      </ul>
      <li>Features</li>
      <ul>
        <li>Content features</li>
        <ul>
          <li>Concatenated texts from post body, hash tags, etc</li>
          <li>Collection of images</li>
        </ul>
        <li>Behavioral Features</li>
        <ul>
          <li>Comments</li>
          <li>Features should be normalized and correctly by time</li>
          <li>Number of negative reactions (hide, angry, etc) per view</li>
          <li>NUmver of shares per view</li>
        </ul>
        <li>Creator Features</li>
        <ul>
          <li>User embeddings - create embeddings of user profile</li>
          <li>Age of user account</li>
          <li>Number of harmful posts so far</li>
        </ul>
      </ul>
    </ul>

    <h3 class="card-title">Modelling</h3>
    <ul>
      <li>Benchmark models</li>
      <ul>
        <li>Logistic regressiom with numerical and embedding features</li>
      </ul>
      <li>Model selection</li>
      <ul>
        <li>Train models for text and image separately, then combine prediction -  cannot capture interaction between image and text</li>
        <li>Multi-modal transformer - high compute cost</li>
      </ul>
      <li>Model architecture</li>
      <ul>
        <li>Multi-modal encoder</li>
        <ul>
          <li>ViT for processing images</li>
          <li>Text tokenizer and encoder for processing texts</li>
          <li>Cross-attention to layer to combine modalities</li>
          <li>Additional embedding layer for behavioral and creator features</li>
        </ul>
        <li>Lightweight update network</li>
        <ul>
          <li>Merge dense features with embeddings of modalities</li>
        </ul>
        <li>Classification heads</li>
        <ul>
          <li>Separate head for eash task</li>
          <li>Shared layer to learn common patterns</li>
          <li>Calibration layer</li>
        </ul>
      </ul>
      <li>Loss function</li>
      <ul>
        <li>Train two separate heads</li>
        <ul>
          <li>\( \text{L_primary} = \text{BCE(y_true, y_pred)} * \text{min(log(1+views), c)} \)</li>
          <li>\( \text{L_reports} = \text{MSE(report_rate, predicted_report_rate)} \)</li>
        </ul>
        <li>Total loss</li>
        <ul>
          <li>\( \text{L} = \alpha * \text{L_primary} + \beta * \text{L_reports} \)</li>
        </ul>
        <li>During prediction, ignore all heads except the primary</li>
      </ul>
      <img class="img-fluid" class="card-img-top" src="/machine-learning-system-design/image/mlsd-d/harmful-content-2.png" alt="Card image cap">
    </ul>

    <h3 class="card-title">Inference and Evaluation</h3>
    <ul>
      <li>Scaling</li>
      <ul>
        <li>Model quantization</li>
        <li>Encoder cache - identical images and text will be served by cache, rather than going through encoder</li>
        <li>Use distilled model with fewer features to filter out obvious non-harmful contents</li>
      </ul>
      <img class="img-fluid" class="card-img-top" src="/machine-learning-system-design/image/mlsd-d/harmful-content-3.png" alt="Card image cap">
      <li>Triggering</li>
      <ul>
        <li>When dynamic features are updated, re-trigger the model</li>
      </ul>
      <li>Offline</li>
      <ul>
        <li>Run model against test set</li>
        <li>PR-AUC</li>
        <li>Recall@Precision95</li>
      </ul>
      <li>Online</li>
      <ul>
        <li>Use candidate and control, and make prediction using only one of them</li>
      </ul>
    </ul>

    <h3 class="card-title">Deep Dives</h3>
    <ul>
      <li>Embedding models for users</li>
      <ul>
        <li>Model quantization</li>
        <li>Encoder cache - identical images and text will be served by cache, rather than going through encoder</li>
        <li>Use distilled model with fewer features to filter out obvious non-harmful contents</li>
      </ul>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: <a href="https://www.hellointerview.com">hello interview</a>
  </div>
</div>

<div class="card mb-4" id="hello-interview-2">
  <div class="card-body">
    <h2 class="card-title">Bot Detection</h2>

    <h3 class="card-title">Problem Framing</h3>
    <ul>
      <li>Clarify the problem</li>
      <ul>
        <li>What is the goal of the system? Separate user activity from malicious bot activity</li>
        <li>What is percentage of bot activity if left unmonitored? Over 50%</li>
        <li>What is impact of false positive? User engagement drops</li>
        <li>How quickly should the system catch bot? As soon as possible</li>
        <li>How many daily active users are there? 500M per day</li>
      </ul>
      <li>Establish a business objective</li>
      <ul>
        <li>Minimize impact of bot activity on user experience</li>
      </ul>
      <li>Decide on an ML objective</li>
      <ul>
        <li>Binary classification to determine if account is bot or not</li>
      </ul>
    </ul>

    <h3 class="card-title">High Level Design</h3>
    <img class="img-fluid" class="card-img-top" src="/machine-learning-system-design/image/mlsd-d/bot-detection-1.png" alt="Card image cap">

    <h3 class="card-title">Data and Features</h3>
    <ul>
      <li>Training data</li>
      <ul>
        <li>Ground truth labels</li>
        <li>User-generated signals</li>
        <ul>
          <li>User reports on accounts</li>
          <li>User reports on contents</li>
          <li>Appeal outcome - detect false positive</li>
        </ul>
        <li>Network-based labels</li>
        <ul>
          <li>Accounts originating known malicious IPs are positive labels</li>
          <li>Accounts behaving similar to known bots</li>
          <li>Bulk account creation</li>
        </ul>
        <li>Synthetic data generation</li>
      </ul>
      <li>Features</li>
      <ul>
        <li>Activity patterns</li>
        <ul>
          <li>Posting cadence</li>
          <li>Click timing precision</li>
          <li>Error rates (that are natural to humans)</li>
          <li>Session patterns</li>
          <li>Activity distribution across days</li>
          <li>Spike in activity that exceeds human capability</li>
        </ul>
        <li>Content signals</li>
        <ul>
          <li>Topic and vocabulary similarity across posts</li>
          <li>Exact or near-duplicate contents</li>
          <li>Grammar and coherence</li>
          <li>NUmver of shares per view</li>
        </ul>
        <li>Network topology features</li>
        <ul>
          <li>Following/follower ratio</li>
          <li>Network growth rate</li>
        </ul>
        <li>Account metadata</li>
        <ul>
          <li>Account age, verification status, profile completeness</li>
          <li>Login frequency, device diversity, location consistency</li>
          <li>Username patterns, profile photo characteristics</li>
        </ul>
        <li>Real-time behavioral signals</li>
        <ul>
          <li>How often account is flagged</li>
          <li>Changes in behavior after being flagged</li>
          <li>Frequency and success rate of appeals</li>
        </ul>
      </ul>
    </ul>

    <h3 class="card-title">Modelling</h3>
    <ul>
      <li>Benchmark models</li>
      <ul>
        <li>Logistic regressiom with straight-forward features</li>
      </ul>
      <li>Model selection</li>
      <ul>
        <li>Single model relying on contents -  running language and vision models on every post is very expensive and misses behavior features</li>
        <li>Graph-sequence approach</li>
      </ul>
      <li>Model architecture</li>
      <ul>
        <li>Graph branch</li>
        <ul>
          <li>Use compact k-hop (k=2) graph</li>
          <li>Use GraphSAGE</li>
        </ul>
        <li>Activity branch</li>
        <ul>
          <li>Bucket timestamps into 5-minutes slots</li>
          <li>Embed event types (post, like, login, device switch, etc)</li>
          <li>Feed sequence through bi-directional GRU/LSTM</li>
        </ul>
        <li>Fusion</li>
        <ul>
          <li>Output vectors of two branches meet in cross-attention layer</li>
        </ul>
      </ul>
      <img class="img-fluid" class="card-img-top" src="/machine-learning-system-design/image/mlsd-d/bot-detection-2.png" alt="Card image cap">
      <li>Pretraining</li>
      <ul>
        <li>Training large model with limited data and binary classification, which leads to overfitting</li>
      </ul>
      <li>Loss function</li>
    </ul>

    <h3 class="card-title">Inference and Evaluation</h3>
    <ul>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: <a href="https://www.hellointerview.com">hello interview</a>
  </div>
</div>
<!-- Hello Interview END -->

</div> <!-- /.col-md-12 -->
</div> <!-- /.row -->
</div> <!-- /.container -->

<include src="/footer.html"></include>

</body>

</html>
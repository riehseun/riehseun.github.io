<!DOCTYPE html>

<html lang="en">

<head>

<!-- Metadata -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="Seungmoon Rieh">
<meta name="keywords" content="">

<!-- Title and image -->
<title>Seungmoon Rieh</title>
<link href="/img/seungmoonrieh.jpg" rel="icon">

<!-- CSS -->
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/monokai-sublime.css" rel="stylesheet">
<link href="/css/site.css" rel="stylesheet">

<!-- JavaScript -->
<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/bootstrap.bundle.min.js" type="text/javascript"></script>
<script src="/js/highlight.pack.js" type="text/javascript"></script>
<script src="/js/include_html.js" type="text/javascript"></script>
<script src="/js/mathjax/tex-chtml.js" type="text/javascript"></script>
<script src="/js/site.js" type="text/javascript"></script>

</head>

<body>

<include src="/header.html"></include>

<div class="container">
<div class="row">
<div class="col-md-12">
<h1 class="my-4">Machine Learning</h1>

<!-- Feed Recommendation BEGIN -->
<div class="card mb-4" id="feed-recommendation">
  <div class="card-body">
    <h2 class="card-title">Feed Recommendation</h2>
    <ul class="list-unstyled mb-0">
      <li><a href="#feed-recommendation-">Feed Recommendation</a></li>
    </ul>
  </div>
</div>

<div class="card mb-4" id="feed-recommendation-">
  <div class="card-body">
    <h2 class="card-title">Feed Recommendation</h2>

    <img class="img-fluid" class="card-img-top" src="/machine-learning-system-design/image/mlsd-1/1-1-1.png" alt="Card image cap">
    <img class="img-fluid" class="card-img-top" src="/machine-learning-system-design/image/mlsd-1/1-1-2.png" alt="Card image cap">
    <img class="img-fluid" class="card-img-top" src="/machine-learning-system-design/image/mlsd-1/1-1-3.png" alt="Card image cap">

<pre><code class="markdown">
# Requirement and Problem

What kind of feed is this? Instagram Feed
What is the goal of the system? Increasing user engagement? Yes
How is user engagement measured? User likes, shares, views, comments? Yes
What does a feed consist of? Text, Image, Video
Can users follow each other? Yes
Should videos be personalized for each user? Yes
Should the system support multiple language? No

Should the system generate training data from user interaction? Yes
How many users are there? 1B total, 100M daily
How many posts do each user upload on average? 1 per day
How many posts do each user view on average? 100 per day

How fast should the feed be generated? Under 200ms
Should the model be deployed to mobile devices? Up to you

Input - user
Output - list of posts ranked by relevance to user
Problem - supervised ranking

# High-Level Design

# Data and Feature Engineering

## Data Model
User, Post, UserPostInteraction, Comment, UserFollower, Image, Video
View - how to determine if users viewed the post? If user spent more than 2 seconds 

## Features
User direct interaction with post - like, share, comment, view
Post features - number of likes, shares, comments, view, text, text language, image, video
Author features - historical popularity of posts uploaded by the author, whether author is followed by the user

## Feature Engineering
Numerical (number of likes, shares, comments, etc) - Standardize (mean 0, variance 1)
Categorical Dense (Age, Gender) - one-hot
Categorical Sparse (User ID, Post ID) - Embedding to learn
Text - encoder only model like BERT
Image - image encoder like CLIP
Video - video encoder like CLIP
  
# Model Development

## Baseline
Heuristics - rank posts by total number of direct interaction (like, share, comment)
Logistic regression - binary classification on whether users will like/share/comment/view post or not

## Architecture
Collaborative filtering - user-post historical interaction only
Content-based filtering - uses post features
First generate 10k candidates using collaborative filtering
If user-post interaction is missing, use popular posts for start
Then, generate 1k candidates using content-based filtering (model)
 
## Training
Ground truth
Positive if user performs direct interaction (like, share, comment, etc)
Positive if user spends more than 2 seconds to view the post 
Negative o/w

Binary classification
Loss - cross-entropy (log-loss) - 1 if post is relevant to user, 0 o/w
Take dot product between post and user embedding
How to define relevance? Weighted score of probabilities of view, like, share, comment

# Inference and Evaluation

Candidate generation can happen offline just using user's and post's batch features, user-user and post-post simiarity is computed along with user-post historical interactions to generate candidates 
Scoring service sends pre-generated candidates to model, to get scores

## Offline eval
Candidate generation - recall to measure percentage of actual relevant posts that it could retrieve
Scoring - recall
Ranking - precision to measure percentage of relevant posts in the feed shown to user 
Overall - NDCG

## Online eval
Click-through rate
Average amount of time that users spend in the app
Amount of userâ€™s direct engagement (like, share, etc)
</code></pre>
  </div>
  <div class="card-footer text-muted">
    Reference: 
  </div>
</div>
<!-- Feed Recommendation END -->

</div> <!-- /.col-md-12 -->
</div> <!-- /.row -->
</div> <!-- /.container -->

<include src="/footer.html"></include>

</body>

</html>
<!DOCTYPE html>

<html lang="en">

<head>

<!-- Metadata -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="Seungmoon Rieh">
<meta name="keywords" content="">

<!-- Title and image -->
<title>Seungmoon Rieh</title>
<link href="/img/seungmoonrieh.jpg" rel="icon">

<!-- CSS -->
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/monokai-sublime.css" rel="stylesheet">
<link href="/css/site.css" rel="stylesheet">

<!-- JavaScript -->
<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/bootstrap.bundle.min.js" type="text/javascript"></script>
<script src="/js/highlight.pack.js" type="text/javascript"></script>
<script src="/js/include_html.js" type="text/javascript"></script>
<script src="/js/mathjax/tex-chtml.js" type="text/javascript"></script>
<script src="/js/site.js" type="text/javascript"></script>

</head>

<body>

<include src="/header.html"></include>

<div class="container">
<div class="row">
<div class="col-md-12">
<h1 class="my-4">Machine learning</h1>

<!-- Machine learning system design BEGIN -->
<div class="card mb-4" id="machine-learning-system-design">
  <div class="card-body">
    <h2 class="card-title">Machine learning system design</h2>
    <ul class="list-unstyled mb-0">
      <li><a href="#machine-learning-system-design-">Machine learning system design</a></li>
      <li><a href="#machine-learning-system-design-">Requirement</a></li>
      <li><a href="#machine-learning-system-design-">Problem</a></li>
      <li><a href="#machine-learning-system-design-">Data preparation</a></li>
      <li><a href="#machine-learning-system-design-">Model development</a></li>
      <li><a href="#machine-learning-system-design-">Evaluation</a></li>
      <li><a href="#machine-learning-system-design-">Serving</a></li>
    </ul>
  </div>
</div>

<div class="card mb-4" id="machine-learning-system-design-">
  <div class="card-body">
    <h2 class="card-title">Machine learning system design</h2>
    <ul>
      <li>Talking points</li>
      <ul>
        <li>Discuss business requiremnent</li>
        <li>Discuss machine learning problem</li>
        <li>Discuss business metrics</li>
        <li>Discuss online metrics</li>
        <li>Discuss architectural component</li>
        <li>Discuss training data</li>
        <li>Discuss offline metrics</li>
        <li>Discuss features</li>
        <li>Discuss model</li>
      </ul>
    </ul>

    <h3 class="card-title">Design problems</h3>
    <ul>
      <li>Practice</li>
      <ul>
        <li><a href="/machine-learning/2.3-instagram.html">Design instragram</a></li>
        <li><a href="/machine-learning/2.3-chatbot.html">Design chatbot</a></li>
        <li><a href="/machine-learning/2.3-banking.html">Design banking</a></li>
      </ul>
      <li>Example</li>
      <ul>
        <li><a href="/machine-learning/2.1-visual-search-system.html">Design visual search system</a></li>
        <li><a href="/machine-learning/2.1-google-street-view-blurring-system.html">Design google street view blurring system</a></li>
        <li><a href="/machine-learning/2.1-youtube-video-search.html">Design youtube video search</a></li>
        <li><a href="/machine-learning/2.1-harmful-content-detection.html">Design harmful content detection</a></li>
        <li><a href="/machine-learning/2.1-video-recommendation-system.html">Design video recommendation system</a></li>
        <li><a href="/machine-learning/2.1-event-recommendation-system.html">Design event recommendation system</a></li>
        <li><a href="/machine-learning/2.1-ad-click-prediction-on-social-platform.html">Design ad click prediction on social platform</a></li>
        <li><a href="/machine-learning/2.1-similar-listings-on-vacation-rental-platforms.html">Design similar listings</a></li>
        <li><a href="/machine-learning/2.1-personalized-news-feed.html">Design personalized newsfeed</a></li>
        <li><a href="/machine-learning/2.1-people-you-may-know.html">Design people you may know</a></li>
        <li><a href="/machine-learning/2.2-gmail-smart-compose.html">Design google smart compose</a></li>
        <li><a href="/machine-learning/2.2-google-translate.html">Design google translate</a></li>
        <li><a href="/machine-learning/2.2-chatgpt.html">Design ChatGPT</a></li>
        <li><a href="/machine-learning/2.2-image-captioning.html">Design image captioning</a></li>
        <li><a href="/machine-learning/2.2-rag.html">Design RAG</a></li>
        <li><a href="/machine-learning/2.2-realistic-face-generation.html">Design realistic face generation</a></li>
        <li><a href="/machine-learning/2.2-high-resolution-image-synthesis.html">Design high-resolution image synthesis</a></li>
        <li><a href="/machine-learning/2.2-text-to-image-generation.html">Design text-to-image generation</a></li>
        <li><a href="/machine-learning/2.2-personalized-headshot-generation.html">Design personalized headshot generation</a></li>
        <li><a href="/machine-learning/2.2-text-to-video-generation.html">Design text-to-video generation</a></li>
      </ul>
    </ul>
    <h3 class="card-title">Other problems</h3>
    <ul>
      <li>Explain difference between batch serving and online serving</li>
      <li>Explain strategies for re-training the model</li>
      <li>Explain how to use model registry and model versioning</li>
      <li>Explain how to monitor the model</li>
      <li>Explain how to orchestrate workflow using Airflow/Kubeflow"</li>
      <li>Explain how to track experiments using MLflow</li>
      <li>Explain how to achieve scaling, load-balancing, fast response for LLM application</li>
      <li>Explain how to use caching to improve LLM performance</li>
      <li>Explain how to reduce model size and optimize for deployment on smart phones</li>
      <li>Explain trade-off between GPU and TPU</li>
      <li>Explain how to monitor LLM in production</li>
      <li>Explain how vector database work</li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: 
  </div>
</div>

<div class="card mb-4" id="machine-learning-system-design-">
  <div class="card-body">
    <h2 class="card-title">Requirement</h2>
    <ul>
      <li>Business objective</li>
      <ul>
        <li>What is purpose of the model?</li>
        <li>Should the model personalize outputs for each user?</li>
        <li>Should the model handle bias and fairness concern?</li>
        <li>Should the model support multiple languages?</li>
      </ul>
      <li>System features</li>
      <ul>
        <li>What user actions are available?</li>
      </ul>
      <li>Data</li>
      <ul>
        <li>What is data source?</li>
        <li>How large is data?</li>
        <li>Is data labeled?</li>
      </ul>
      <li>Constraints</li>
      <ul>
        <li>How much computing power is available?</li>
        <li>Should the model be deployed to mobile devices?</li>
        <li>Should the model be continuouly trained?</li>
      </ul>
      <li>Scale</li>
      <ul>
        <li>How many total users? How many daily active users?</li>
        <li>How many inferences per user per day?</li>
        <li>How many items?</li>
        <li>What is the rate of growth?</li>
      </ul>
      <li>Performance</li>
      <ul>
        <li>Batch or real-time inference?</li>
        <li>What is the maximum latency allowed?</li>
      </ul>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: Machine Learning System Design Interview, Ali Aminian & Alex Xu | Generative AI System Design Interview, Ali Aminian & Hao Sheng
  </div>
</div>

<div class="card mb-4" id="machine-learning-system-design-">
  <div class="card-body">
    <h2 class="card-title">Problem</h2>

    <h3 class="card-title">ML problem</h3>
    <ul>
      <li>Identify input and output of model</li>
      <li>Discrimitive</li>
      <ul>
        <li>Recommendation system</li>
        <li>Fraud detection</li>
        <li>Churn prediction</li>
      </ul>
      <li>Generative</li>
      <ul>
        <li>Machine translation</li>
        <li>Sentiment analysis</li>
        <li>Text, image, video generation</li>
      </ul>
    </ul>

    <h3 class="card-title">ML category</h3>
    <ul>
      <li>Discrimitive</li>
      <ul>
        <li>Supervised learning</li>
        <ul>
          <li>Neural networks</li>
          <ul>
            <li>Linear network</li>
            <ul>
              <li>Linear regression (regression only)</li>
              <li>Logistic regression (classification only - binary, multi-class)</li>
            </ul>
            <li>Deep neural networks</li>
          </ul>
          <li>Decision trees</li>
          <li>k-nearest neighbors (KNN)</li>
        </ul>
        <li>Unsupervised learning</li>
        <ul>
          <li>Clustering</li>
          <ul>
            <li>Density-based spacial clustering with noise (DBSCAN)</li>
            <li>K-means clustering - partition points into K subsets, compute centroid of current partitioning, assign each point to cluster</li>
          </ul>
          <li>Dimension reduction</li>
          <ul>
            <li>Principle component analysis (PCA)</li>
            <li>Isomap</li>
          </ul>
        </ul>
      </ul>
      <li>Generative</li>
      <ul>
        <li>Text</li>
        <ul>
          <li>Pre-training</li>
          <ul>
            <li>Encoder-decoder</li>
            <li>Encoder only</li>
            <li>Decoder only</li>
          </ul>
          <li>Fine-tuning</li>
          <ul>
            <li>Reinforcement learning from human feedback</li>
          </ul>
          <li>Retrieval augmented generation</li>
          <ul>
            <li>Agentic</li>
          </ul>
        </ul>
        <li>Image</li>
        <ul>
          <li>Variational autoencoders (VAEs)</li>
          <li>Generative adversarial networks (GANs)</li>
          <li>Diffusion models</li>
          <li>Autoregressive models</li>
        </ul>
      </ul>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: Machine Learning System Design Interview, Ali Aminian & Alex Xu | Generative AI System Design Interview, Ali Aminian & Hao Sheng
  </div>
</div>

<div class="card mb-4" id="machine-learning-system-design-">
  <div class="card-body">
    <h2 class="card-title">Data preparation</h2>

    <h3 class="card-title">Data engineering</h3>
    <ul>
      <li>Identify data sources and their storage type</li>
      <ul>
        <li>SQL</li>
        <ul>
          <li>Ex. MySQL, PostgreSQL</li>
        </ul>
        <li>NoSQL</li>
        <ul>
          <li>Key-value</li>
          <ul>
            <li>Ex. Redis, DynamoDB</li>
          </ul>
          <li>Column-based</li>
          <ul>
            <li>Ex. Cassandra, HBase</li>
          </ul>
          <li>Graph</li>
          <ul>
            <li>Ex. Neo4J</li>
          </ul>
          <li>Document</li>
          <ul>
            <li>Encoded as JSON, XML</li>
            <li>Each document has a unique key</li>
            <li>Does not enforce any schema</li>
            <li>Hard to join documents</li>
            <li>Ex. MongoDB, CouchDB</li>
          </ul>
        </ul>
      </ul>
      <li>ETL</li>
      <ul>
        <li>Extract - extract data from different data sources</li>
        <li>Transform - clean and transform data into specific format</li>
        <li>Load - load transformed data into target data warehouse</li>
      </ul>
      <!-- <li>Training data</li>
      <ul>
        <li>Collect raw data</li>
        <li>Identify features and labels</li>
        <li>Sampling</li>
        <li>Split data</li>
        <ul>
          <li>Split must be repeatable</li>
          <ul>
            <li>Use fixed seed number</li>
            <li>If distributed training environment, store the splitted data</li>
          </ul>
        </ul>
        <li>Address class imbalance</li>
      </ul> -->
      <!-- <li>Database</li>
      <ul>
        
        </ul> -->
        <!-- <li>In which format should data be stored?</li> -->
        <!-- <li>How to store multimodal data? (Data containing both image and text)</li> -->
      </ul>
    </ul>

    <h3 class="card-title">Exclusion</h3>

    <h3 class="card-title">Base population (Sampling)</h3>

    <h3 class="card-title">Target generation</h3>

    <h3 class="card-title">Feature engineering</h3>
    <ul>
      <li>Feature selection</li>
      <ul>
        <li>Ex. Leverage domain experts to select universe of features</li>
        <li>Ex. Use decision tree to narrow down features</li>
      </ul>
      <li>Feature transformation</li>
      <ul>
        <li>Handle missing values</li>
        <li>Scaling</li>
        <li>Bucketing</li>
        <li>Encode categorial features</li>
      </ul>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: Machine Learning System Design Interview, Ali Aminian & Alex Xu | Generative AI System Design Interview, Ali Aminian & Hao Sheng
  </div>
</div>

<div class="card mb-4" id="machine-learning-system-design-">
  <div class="card-body">
    <h2 class="card-title">Model development</h2>

    <h3 class="card-title">Model selection</h3>
    <ul>
      <li>Linear or logistic regression</li>
      <ul>
        <li>Pros</li>
        <ul>
          <li></li>
        </ul>
        <li>Cons</li>
        <ul>
          <li></li>
        </ul>
      </ul>
      <li>XGBoost</li>
      <ul>
        <li>Pros</li>
        <ul>
          <li></li>
        </ul>
        <li>Cons</li>
        <ul>
          <li></li>
        </ul>
      </ul>
      <li>Neural network</li>
      <ul>
        <li>Pros</li>
        <ul>
          <li></li>
        </ul>
        <li>Cons</li>
        <ul>
          <li></li>
        </ul>
      </ul>
    </ul>

    <h3 class="card-title">Model training</h3>
    <ul>
      <li>Data split</li>
      <li>Class imbalance</li>
      <li>Loss function</li>
      <ul>
        <li>Regression</li>
        <ul>
          <li>MSE</li>
          <li>MAE</li>
        </ul>
        <li>Binary classification</li>
        <ul>
          <li>Log loss</li>
        </ul>
        <li>Multiclass classification</li>
        <ul>
          <li>Cross-entropy</li>
        </ul>
        <li>?</li>
        <ul>
          <li>Huber loss</li>
        </ul>
      </ul>
      <li>Hyperparameters</li>
      <ul>
        <li>Deep learning</li>
        <ul>
          <li>Learning rate</li>
          <li>Number of hidden layers</li>
          <li>Batch size</li>
          <li>Number of epochs</li>
          <li>Dropout rate</li>
        </ul>
      </ul>
      <li>Sampling</li>
      <ul>
        <li>Model recalibration</li>
        <ul>
          <li>Assume undersampling</li>
          <li>\( q = \dfrac{p}{p+\dfrac{1-p}{w}} \)</li>
          <ul>
            <li>\( q \) - re-calibrated prediction score</li>
            <li>\( p \) is prediction in downsampling space</li>
            <li>\( w \) is undersampling rate</li>
          </ul>
        </ul>
      </ul>
      <!-- <li>Regularization</li>
      <ul>
        <li>L1</li>
        <li>L2</li>
        <li>Entropy regularization</li>
        <li>K-fold CV</li>
        <li>Dropout</li>
      </ul>
      <li>Optimization</li>
      <ul>
        <li>SGD</li>
        <li>AdaGrad</li>
        <li>Momentum</li>
        <li>RMSProp</li>
      </ul>
      <li>Activation</li>
      <ul>
        <li>ELU</li>
        <li>ReLU</li>
        <li>Tanh</li>
        <li>Sigmoid</li>
      </ul>
      <li>Save the transformation applied to convert model inputs into features</li>
      <li>How to overcome underfitting and overfitting (bias and variance)</li> -->
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: Machine Learning System Design Interview, Ali Aminian & Alex Xu | Generative AI System Design Interview, Ali Aminian & Hao Sheng
  </div>
</div>

<div class="card mb-4" id="machine-learning-system-design-">
  <div class="card-body">
    <h2 class="card-title">Evaluation</h2>

    <h3 class="card-title">Offline</h3>
    <ul>
      <li>Classification</li>
      <ul>
        <li>Precision</li>
        <li>Recall</li>
        <li>F1 score</li>
        <li>Accuracy</li>
        <li>ROC-AUC</li>
        <ul>
          <li>Used for binary classification</li>
          <li>Does not penalize how far off predicted score is from the actual label</li>
          <li>Insensitive to well-calibrated probabilities</li>
        </ul>
        <li>PR-AUC</li>
        <li>Confusion matrix</li>
      </ul>
      <li>Regression</li>
      <ul>
        <li>MSE</li>
        <li>MAE</li>
        <li>RMSE</li>
      </ul>
      <li>Ranking</li>
      <ul>
        <li>Precision@k</li>
        <li>Recall@k</li>
        <li>MRR</li>
        <li>mAP</li>
        <ul>
          <li>Assume total items are 10. Recommended items are 5 and user find 3 of them relevant</li>
          <li>\( AP@N = \frac{1}{m} \sum_{k=1}^N P(k) \cdot rel(k) = \frac{1}{10} \cdot (1*\frac{1}{1} + 1*\frac{2}{2} + 0*\frac{2}{3} + 1*\frac{3}{4} + 0*\frac{3}{5}) = 0.275 \)</li>
        </ul>
        <li>mAR</li>
        <ul>
          <li>\( AR@N = \frac{1}{m} \sum_{k=1}^N R(k) \cdot rel(k) = \frac{1}{10} \cdot (1*\frac{1}{10} + 1*\frac{2}{10} + 0*\frac{2}{10} + 1*\frac{3}{10} + 0*\frac{3}{10}) = 0.06 \)</li>
        </ul>
        <li>nDCG</li>
        <ul>
          <li>Assume the documents are \( D1, D2, D3, D4 \) in the order of relevance</li>
          <li>Assume human rates the documents on scale of 0-3 (3 is highly relevant, 0 is merely relevant) such that</li>
          <ul>
            <li>\( D1=3, D2=2, D3=3, D4=0 \)</li>
          </ul>
          <li>Cumulative gain simply adds</li>
          <ul>
            <li>\( 3 + 2 + 3 + 0 = 8 \)</li>
          </ul>
          <li>Discounted cumulative gain (DCG) penalizes if highly relevant document appears lower in the result</li>
          <ul>
            <li>\( \frac{3}{log(1+1)} + \frac{2}{log(2+1)} + \frac{3}{log(3+1)} + \frac{0}{log(4+1)} = 3 + 1.262 + 1.5 + 0 = 5.762 \)</li>
          </ul>
          <li>Discounted cumulative gain for a query with long result will be higher due to its length rather than its quality</li>
          <li>Normalized discounted cumulative gain (NDCG) is computed by (DCG / IDCG) where IDCG is DCG of ideal ordering</li>
          <ul>
            <li>Near 1 means good result. Near 0 means bad result</li>
            <li>Caveat - NDCG does not penalize irrelevant search result</li>
          </ul>
        </ul>
      </ul>
      <li>Text generation</li>
      <ul>
        <li>BLUE</li>
        <li>METEOR</li>
        <li>ROUGE</li>
        <li>CIDEr</li>
        <li>SPICE</li>
      </ul>
      <li>Image generation</li>
      <ul>
        <li>FID</li>
        <li>Inception score</li>
      </ul>
    </ul>
      <!-- <li>Baselines</li>
      <ul>
        <li>Random baseline</li>
        <li>Simple heuristic</li>
        <li>Zero rule baseline</li>
        <li>Human baseline</li>
        <li>Existing solutions</li>
      </ul>
      <li>Methods</li>
      <ul>
        <li>Purturbation tests</li>
        <li>Invariance tests</li>
        <li>Directional expectation tests</li>
        <li>Model calibration</li>
        <li>Confidence measurement</li>
        <li>Slice-based evaluation</li>
      </ul> -->
    
    <h3 class="card-title">Online</h3>
    <ul>
      <li>Increase in revenue</li>
      <li>Increase in engagement - number of users, click through rate, dwell time, etc</li>
      <li>Decrease in counter metrics - number of hides, blocks, etc</li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: Machine Learning System Design Interview, Ali Aminian & Alex Xu | Generative AI System Design Interview, Ali Aminian & Hao Sheng
  </div>
</div>

<div class="card mb-4" id="machine-learning-system-design-">
  <div class="card-body">
    <h2 class="card-title">Serving</h2>

    <h3 class="card-title">Data pipeline</h3>

    <img class="img-fluid" class="card-img-top" src="/machine-learning/image/machine-learning-system-design-0/machine-learning-system-design-1.png" alt="Card image cap">

    <h3 class="card-title">Training pipeline</h3>

    <img class="img-fluid" class="card-img-top" src="/machine-learning/image/machine-learning-system-design-0/machine-learning-system-design-2.png" alt="Card image cap">

    <h3 class="card-title">Serving pipeline</h3>

    <img class="img-fluid" class="card-img-top" src="/machine-learning/image/machine-learning-system-design-0/machine-learning-system-design-3.png" alt="Card image cap">

    <li>Pre-processing</li>
    <ul>
      <li>Query rewriting</li>
      <ul>
        <li>Spell checker - fix basic spelling mistakes</li>
        <li>Query expansion - add terms to user query. For example, "restaurant" is expaneded to "food" or "recipe"</li>
      </ul>
    </ul>
    
    <!-- <ul>
      <li>ML failure</li>
      <ul>
        <li>Edge cases</li>
        <li>Degenerate feedback loops</li>
        <ul>
          <li>Detecting</li>
          <li>Correcting</li>
        </ul>
      </ul>
    </ul> -->

    <li>Model compression</li>
    <ul>
      <li>Knowledge distillation - train small model to mimic larger model</li>
      <li>Pruning - find least useful parameters and set them to zero</li>
      <li>Quantization - use fewer bits to represent parameters</li>
    </ul>

    <li>Cloud vs on-device</li>
    <ul>
      <li>Cloud - simple to deploy, faster inference, fewer constraints</li>
      <li>On-device - no cloud cost, no network latency, more privacy, no internet required</li>
      <li>Two-phase prediction</li>
      <ul>
        <li>A problem is split into two parts</li>
        <li>Smaller and cheaper model deployed on device that can achieve high accuracy</li>
        <li>More complex model on cloud that is triggered only when it is needed</li>
      </ul>
    </ul>

    <li>Shadow deployment</li>
    <ul>
      <li>Deploy new model in parallel with existing model</li>
      <li>Inference from existing model is served to users</li>
      <li>Double number of prediction is needed</li>
    </ul>

    <li>A/B testing</li>
    <ul>
      <li>Deploy new model in parallel with existing model</li>
      <li>Portion of traffic is routed to new model</li>
    </ul>

    <li>Continuous training</li>
    <ul>
      <li></li>
      <li></li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: Machine Learning System Design Interview, Ali Aminian & Alex Xu | Generative AI System Design Interview, Ali Aminian & Hao Sheng
  </div>
</div>
<!-- Machine learning system design END -->

</div> <!-- /.col-md-12 -->
</div> <!-- /.row -->
</div> <!-- /.container -->

<include src="/footer.html"></include>

</body>

</html>
<!DOCTYPE html>

<html lang="en">

<head>

<!-- Metadata -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="Seungmoon Rieh">
<meta name="keywords" content="">

<!-- Title and image -->
<title>Seungmoon Rieh</title>
<link href="/img/seungmoonrieh.jpg" rel="icon">

<!-- CSS -->
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/monokai-sublime.css" rel="stylesheet">
<link href="/css/site.css" rel="stylesheet">

<!-- JavaScript -->
<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/bootstrap.bundle.min.js" type="text/javascript"></script>
<script src="/js/highlight.pack.js" type="text/javascript"></script>
<script src="/js/include_html.js" type="text/javascript"></script>
<script src="/js/mathjax.js" type="text/javascript"></script>
<script src="/js/site.js" type="text/javascript"></script>

</head>

<body>

<include src="/header.html"></include>

<div class="container">
<div class="row">
<div class="col-md-12">
<h1 class="my-4">Other</h1>

<!-- System design BEGIN -->
<div class="card mb-4" id="system-design">
  <div class="card-body">
    <h2 class="card-title">System design</h2>
    <p class="card-text"></p>
    <ul class="list-unstyled mb-0">
      <li><a href="#system-design-1">System design</a></li>
      <li><a href="#system-design-2">Machine learning system design</a></li>
      <br>
      <li><a href="#system-design-10">Key-value store</a></li>
      <li><a href="#system-design-11">CDN</a></li>
      <li><a href="#system-design-12">Sequencer</a></li>
      <li><a href="#system-design-13">Distributed cache</a></li>
      <li><a href="#system-design-14">Distributed message queue</a></li>
      <li><a href="#system-design-15">Pub-sub</a></li>
      <li><a href="#system-design-16">Rate limiter</a></li>
      <li><a href="#system-design-17">Blob store</a></li>
      <li><a href="#system-design-18">Distributed search</a></li>
      <li><a href="#system-design-19">Distributed task scheduler</a></li>
      <li><a href="#system-design-20">Sharded counter</a></li>
      <br>
      <li><a href="#system-design-100">Google search</a></li>
      <li><a href="#system-design-101">Twitter feed</a></li>
      <li><a href="#system-design-102">Netflix</a></li>
      <li><a href="#system-design-103">Tesla</a></li>
      <li><a href="#system-design-104">Entity linking</a></li>
      <li><a href="#system-design-105">Ad prediction</a></li>
    </ul>
  </div>
</div>

<div class="card mb-4" id="system-design-1">
  <div class="card-body">
    <h2 class="card-title">System design</h2>

    <h3 class="card-title">High level design</h3>
    <img class="img-fluid" class="card-img-top" src="/img/system-design/sd-cicd.png" alt="Card image cap">
    <br>
    <br>

    <h3 class="card-title">Component design</h3>

  </div>
  <div class="card-footer text-muted">

  </div>
</div>

<div class="card mb-4" id="system-design-2">
  <div class="card-body">
    <h2 class="card-title">Machine learning system design</h2>

    <h3 class="card-title">High level design</h3>
    <img class="img-fluid" class="card-img-top" src="/img/system-design/ml-highlevel.png" alt="Card image cap">
    <br>
    <br>

    <h3 class="card-title">Component design</h3>
    <img class="img-fluid" class="card-img-top" src="/img/system-design/ml-development-v1.png" alt="Card image cap">
    <br>
    <br>
    <img class="img-fluid" class="card-img-top" src="/img/system-design/ml-training-v1.png" alt="Card image cap">
    <br>
    <br>
    <img class="img-fluid" class="card-img-top" src="/img/system-design/ml-inference-batch-v1.png" alt="Card image cap">
    <br>
    <br>
    <ul>
      <li>Performce for out-of-sample and out-of-time.</li>
      <li>Features should be mostly unchanged when input data is slighly perturbed. (Could be challgenging when data contains similar/duplicate features)</li>
      <li>Interpretation should not be depending on training sample choices.</li>
    </ul>

    <h3 class="card-title">Problem definition</h3>
    <ul>
      <li>Construct ground truth.</li>
      <li>Metrics.</li>
    </ul>

    <h3 class="card-title">Data prep</h3>
    <ul>
      <li>Proportion of null/zero values across columns.</li>
      <li>Columns that should be rejected due to zero or null values.</li>
      <li>Categorical columns with high cardinality.</li>
      <li>Columns with high sparcity.</li>
      <li>Duplicate columns.</li>
      <li>Compute per-month count of rows and selected attribute to see if they make sense.</li>
      <li>Verify that join keys are consistent across tables.</li>
      <li>Verify that labels/values to apply exclusions are available in the tables.</li>
      <li>Verify that labels/values to apply ground truth are available in the tables.</li>
      <li>Rectify missing values in columns.</li>
      <ul>
      <li>Random missing value - value is missing for unexplained reason.</li>
      <li>Structural missing value - value is missing for a reason. (For example, the fact that it is missing means something)</li>
      <li>Engineered missing value - feature engineering introduced the missing values. (For example, divide by zero)</li>
      <li>Table join mismatch - IDs in one table were missing in another table, so missing values are created after join.</li>
    </ul>
    </ul>

    <h3 class="card-title">Data profiling</h3>
    <ul>
      <li>General statistics.</li>
      <li>Columns with large portion of missing values. (For example, > 10%)</li>
      <ul>
        <li>These columns should generally be retained for they may turn out to be quite predictive.</li>
        <li>XGBoost has build-in capability to handle missing values.</li>
      </ul>
      <li>Similar/duplicate columns. (For example, prefer one feature over another? Can use univariate analysis)</li>
      <li>Columns with consistant values should be removed because they provide no signal.</li>
      <li>Remove sensitive features from model inputs. (For example, age / gender)</li>
      <li>Data imputation (For example, NULL to 0) should rarely happens when feature is critical and will undergo feature engineering and treatment is known.</li>
    </ul>

    <h3 class="card-title">Exclusion</h3>
    <ul>
      <li>Exclude rows based on certain attributes. (This is driven by business reasons)</li>
    </ul>

    <h3 class="card-title">Ground truth construction</h3>

    <h3 class="card-title">Data split</h3>
    <ul>
      <li>Training: In-Time and In-Sample. Split into 5-folds for cross-validation.</li>
      <li>Testing: Out-of-Time test and In-Time & Out-of-Sample test.</li>
      <li>If a data about person is seen at many different dates, all data about that person must be assigned to the same split. (either Out-of-Sample or one of the folds) Otherwise, there is information leak bwetween training and validation.</li>
      <li>Final model is retrained with all 5 folds combined.</li>
    </ul>

    <h3 class="card-title">Data representativeness</h3>
    <ul>
      <li>Separate datasets by ground truth labels.</li>
      <li>Perform univariate analysis. For example, look at the distribution of samples of a key feature for both the entire dataset and the partitioned dataset. Repeat for all key features.</li>
      <li>All paritioned datasets must include sufficient volume of each ground truth labels across key features.</li>
      <li>Bin size may be increased or bins could be combined as a result of above analysis.</li>
    </ul>

    <h3 class="card-title">Model development</h3>
    <ul>
      <li>Define metric to evaluate the model.</li>
      <li>Score the model by the desired metric.</li>
      <li>Check model performace by month to check seasonality.</li>
      <li>Kubernetes based</li>
      <ul>
        <li>Make changes to code.</li>
        <li>Build, test, package the code.</li>
        <li>Build an image which includes the code package.</li>
        <li>Deploy the image to Kubenetes using tools like Skaffold / Helm.</li>
        <li>Run commands inside the image to execute the code.</li>
      </ul>
      <li>Databricks based</li>
      <ul>
        <li>Make changes to code.</li>
        <li>Build, test, package, publish the code.</li>
        <li>Import the code from the notebook.</li>
        <li>Write additional code on the notebook as needed.</li>
        <li>Run commands on the notebook execute the code.</li>
      </ul>
    </ul>

    <h3 class="card-title">Feature selection</h3>
    <ul>
      <li>Start with initial set of feature ~ 1500</li>
      <li>First gate</li>
      <ul>
        <li>Data preparation</li>
        <li>Feature engineering</li>
      </ul>
      <li>After exclusions ~ 1000</li>
      <li>First stage</li>
      <ul>
        <li>Assess each feature individually.</li>
        <li>Select a metric.</li>
        <li>Use 4-folds for training and 1 fold for validation.</li>
        <li>Train a shallow model with a single feature as input and compute performance in validation set.</li>
        <li>Rank individual features.</li>
        <li>Then, train a model wtih all features.</li>
        <li>Then again, rank the features.</li>
      </ul>
      <ul>
        <li>Perform recursive feature search.</li>
        <li>Use 4-folds for training and 1 fold for validation. (Validation fold must be different from previous step)</li>
        <li>For each feature in top N features, train a model and score performance on validation set.</li>
        <li>Add the best scoring features to the candidate features.</li>
      </ul>
      <li>Candidate features ~ 100</li>
      <li>Second gate</li>
      <ul>
        <li>Highly correlated features should be justified or redundant features should be removed.</li>
        <li>Future retraining starts from the candidate features.</li>
      </ul>
      <li>Second stage</li>
      <ul>
        <li>Perform 5-fold cross validation with each candidate feature.</li>
        <li>Compute shapley values on the validation set.</li>
        <li>Select stable features via union of top features across the folds.</li>
      </ul>
      <li>Stable features ~ 40</li>
    </ul>

    <h3 class="card-title">Hyperparameter tuning</h3>
    <ul>
      <li>Ex. grid search, random search, bayesian optimization.</li>
    </ul>

    <h3 class="card-title">Final model training</h3>
    <ul>
      <li>Train the model using stable features and tuned hyperparameters.</li>
      <li>Evaluate on OOS (seasonality) and OOT (final evaluation) test sets.</li>
    </ul>

    <h3 class="card-title">Monitoring</h3>
    <ul>
      <li>Partial dependency plot (PDP) assesses marginal effect of a feature to the model output.</li>
      <li>Indvidual conditional expectation (ICDE) is equivalent to PDP but for an individual data point.</li>
      <li>Feature contribution is assessed via shapley values.</li>
    </ul>
  </div>
  <div class="card-footer text-muted">

  </div>
</div>

<div class="card mb-4" id="system-design-10">
  <div class="card-body">
    <h2 class="card-title">Key-value store</h2>
    <ul>
      <li>Distributed hash table.</li>
      <li>Key is generated by a hash function.</li>
    </ul>

    <h3 class="card-title">Requirement</h3>

    <h4 class="card-title">Functional</h4>
    <ul>
      <li>Users can configure availability vs consistency.</li>
      <li>Users can write into key-value store.</li>
    </ul>

    <h4 class="card-title">Non-functional</h4>
    <ul>
      <li>Availability.</li>
      <li>Reliability.</li>
      <li>Scalability.</li>
    </ul>

    <h3 class="card-title">API</h3>
    <ul>
      <li>get(key)</li>
      <li>put(key, value)</li>
    </ul>

    <h3 class="card-title">Component design</h3>

    <h4 class="card-title">Vector clock</h4>
    <ul>
      <li>A list of (node, counter) pairs.</li>
      <li>If two objects have different vector clocks, we’re able to tell whether they’re causally related or not.</li>
    </ul>

    <h4 class="card-title">Merkle tree</h4>
    <ul>
      <li>Keys are hashed and used as the leaves of the tree.</li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/deep-dive-into-system-design-interview">Deep Dive into System Design Interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-11">
  <div class="card-body">
    <h2 class="card-title">CDN</h2>
    <ul>
      <li>Geographically distributed proxy servers.d</li>
      <li>Proxy servers are placed on the network edge.</li>
    </ul>

    <h3 class="card-title">Requirement</h3>

    <h4 class="card-title">Functional</h4>
    <ul>
      <li>CDN can retrieve content from the origin servers.</li>
      <li>CDN can respond to each user’s request.</li>
      <li>If push model, origin servers can send the content to the CDN.</li>
      <li>CDN can search against a user query.</li>
      <li>CDN can update the content within peer CDN proxy servers.</li>
      <li>CDN can delete contents from cache.</li>
    </ul>

    <h4 class="card-title">Non-functional</h4>
    <ul>
      <li>Availability.</li>
      <li>Reliability.</li>
      <ul>
        <li>No single point of failure.</li>
      </ul>
      <li>Scalability.</li>
      <li>Performance.</li>
      <ul>
        <li>Minimize latency.</li>
      </ul>
    </ul>

    <h3 class="card-title">High level design</h3>
    <ul>
      <li>The origin server provides the URI namespace to request routing system.</li>
      <li>The origin server publishes the content to the distribution system.</li>
      <li>The distribution system distributes the content to the proxy servers and provides feedback to the request routing system.</li>
      <li>User requests the routing system for a suitable proxy server.</li>
      <li>The request routing system returns IP address of a proxy server.</li>
      <li>User requests routes through the scrubber servers for security reasons.</li>
      <li>The scrubber server forwards good traffic to the edge proxy server.</li>
      <li>The edge proxy server serves the client reques.</li>
    </ul>
    <img class="img-fluid" class="card-img-top" src="/img/system-design/cdn1.png" alt="Card image cap">
    <br>
    <br>

    <h3 class="card-title">API</h3>
    <ul>
      <li>retrieve_content(proxyserver_id, content_type, description)</li>
      <li>deliver_content(originserver_id, server_list, content_type, description)</li>
      <li>request_content(user_id, content_type, description)</li>
      <li>search_content(proxyserver_id, content_type, description)</li>
      <li>update_content(proxyserver_id, content_type, description)</li>
    </ul>

    <h3 class="card-title">Component design</h3>

    <h4 class="card-title">Push CDN</h4>
    <ul>
      <li>Content gets sent automatically to the CDN proxy servers from the origin server.</li>
      <li>Appropriate for static content delivery.</li>
    </ul>

    <h4 class="card-title">Pull CDN</h4>
    <ul>
      <li>A CDN pulls the unavailable data from origin servers when requested by a user.</li>
      <li>Appropriate for dynamic content delivery.</li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/deep-dive-into-system-design-interview">Deep Dive into System Design Interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-12">
  <div class="card-body">
    <h2 class="card-title">Sequencer</h2>
    <ul>
      <li>Geographically distributed proxy servers.d</li>
      <li>Proxy servers are placed on the network edge.</li>
    </ul>

    <h3 class="card-title">Requirement</h3>

    <h4 class="card-title">Functional</h4>
    <ul>
      <li>Generate unqiue identifier.</li>
      <li>Length is limited to 64 bits.</li>
    </ul>

    <h4 class="card-title">Non-functional</h4>
    <ul>
      <li>Availability.</li>
      <li>Reliability.</li>
      <li>Scalability.</li>
      <li>Performance.</li>
    </ul>

    <h3 class="card-title">Component design</h3>

    <h4 class="card-title">UUID</h4>
    <ul>
      <li>128-bit number, which makes the primary-key indexing slower</li>
      <li>There is a chance of duplication.</li>
    </ul>

    <h4 class="card-title">Database</h4>
    <ul>
      <li>Difficult to scale for multiple data centers.</li>
    </ul>

    <h4 class="card-title">Range handler</h4>

    <h4 class="card-title">Unix timestamp</h4>

    <h4 class="card-title">Twitter Snowflake</h4>

    <h4 class="card-title">Vector clock</h4>

    <h4 class="card-title">Google TrueTime</h4>
  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/deep-dive-into-system-design-interview">Deep Dive into System Design Interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-13">
  <div class="card-body">
    <h2 class="card-title">Distributed cache</h2>
    <ul>
      <li>Multiple cache servers coordinate to store frequently accessed data.</li>
    </ul>

    <h3 class="card-title">Requirement</h3>

    <h4 class="card-title">Functional</h4>
    <ul>
      <li>Insert data.</li>
      <li>Retrieve data.</li>
    </ul>

    <h4 class="card-title">Non-functional</h4>
    <ul>
      <li>Availability.</li>
      <li>Reliability.</li>
      <li>Scalability.</li>
      <li>Performance.</li>
    </ul>

    <h3 class="card-title">High level design</h3>
    <ul>
      <li>Cache client: holds all the information regarding cache servers.</li>
      <li>Cache server: maintain the cache of the data.</li>
    </ul>
    <img class="img-fluid" class="card-img-top" src="/img/system-design/distributed-cache1.png" alt="Card image cap">
    <br>
    <br>

    <h3 class="card-title">API</h3>
    <ul>
      <li>insert(key, value)</li>
      <li>retrieve(key)</li>
    </ul>

    <h3 class="card-title">Component design</h3>
    <ul>
      <li>Each cache client uses consistent hashing to identify the cache server.</li>
      <li>Each cache server has primary and replica servers.</li>
      <li>Configuration service ensures all users see consistent view of cache servers.</li>
      <li>Monitoring services log and report metrics of cache service.</li>
    </ul>
    <img class="img-fluid" class="card-img-top" src="/img/system-design/distributed-cache2.png" alt="Card image cap">
    <br>
    <br>
  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/deep-dive-into-system-design-interview">Deep Dive into System Design Interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-14">
  <div class="card-body">
    <h2 class="card-title">Distributed message queue</h2>
    <ul>
      <li>Component between producers and consumers.</li>
      <li>Enables asynchronous communication</li>
    </ul>

    <h3 class="card-title">Requirement</h3>

    <h4 class="card-title">Functional</h4>
    <ul>
      <li>Create and delete queue.</li>
      <li>Send, retrieve, delete message.</li>
    </ul>

    <h4 class="card-title">Non-functional</h4>
    <ul>
      <li>Availability.</li>
      <li>Reliability.</li>
      <li>Scalability.</li>
      <li>Performance.</li>
    </ul>

    <h3 class="card-title">High level design</h3>

    <img class="img-fluid" class="card-img-top" src="/img/system-design/distributed-message-queue1.png" alt="Card image cap">
    <br>
    <br>
  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/deep-dive-into-system-design-interview">Deep Dive into System Design Interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-15">
  <div class="card-body">
    <h2 class="card-title">Pub-sub</h2>
    <ul>
      <li>Asynchronous service-to-service communication.</li>
      <li>Producers and consumers are disconnected and operate independently.</li>
    </ul>

    <h3 class="card-title">Requirement</h3>

    <h4 class="card-title">Functional</h4>
    <ul>
      <li>Create and subscribe topic.</li>
      <li>Read, write, and delete message.</li>
      <li>Specify retention time.</li>
    </ul>

    <h4 class="card-title">Non-functional</h4>
    <ul>
      <li>Availability.</li>
      <li>Reliability.</li>
      <li>Scalability.</li>
      <li>Performance.</li>
    </ul>

    <h3 class="card-title">High level design</h3>

    <img class="img-fluid" class="card-img-top" src="/img/system-design/pub-sub1.png" alt="Card image cap">
    <br>
    <br>

    <h3 class="card-title">API</h3>
    <ul>
      <li>create(topic_id, topic_name)</li>
      <li>write(topic_id, message)</li>
      <li>read(topic_id)</li>
      <li>subscribe(topic_id)</li>
      <li>unsubscribe(topic_id)</li>
      <li>delete_topic(topic_id)</li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/deep-dive-into-system-design-interview">Deep Dive into System Design Interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-16">
  <div class="card-body">
    <h2 class="card-title">Rate limiter</h2>
    <ul>
      <li>Prevents DDOS attack.</li>
    </ul>

    <h3 class="card-title">Requirement</h3>

    <h4 class="card-title">Functional</h4>
    <ul>
      <li>Limit number of requests a client can send within time window.</li>
      <li>Make the number of requests within time window configurable.</li>
    </ul>

    <h4 class="card-title">Non-functional</h4>
    <ul>
      <li>Availability.</li>
      <li>Reliability.</li>
      <li>Scalability.</li>
      <li>Performance.</li>
    </ul>

    <h3 class="card-title">High level design</h3>

    <img class="img-fluid" class="card-img-top" src="/img/system-design/rate-limiter1.png" alt="Card image cap">
    <br>
    <br>
  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/deep-dive-into-system-design-interview">Deep Dive into System Design Interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-17">
  <div class="card-body">
    <h2 class="card-title">Blob store</h2>
    <ul>
      <li>For write once, read many.</li>
      <li>Huge amount of unstructured data.</li>
    </ul>

    <h3 class="card-title">Requirement</h3>

    <h4 class="card-title">Functional</h4>
    <ul>
      <li>Create, list, and delete container to group blobs.</li>
      <li>Create, list, update, and delete data.</li>
    </ul>

    <h4 class="card-title">Non-functional</h4>
    <ul>
      <li>Availability.</li>
      <li>Reliability.</li>
      <li>Scalability.</li>
      <li>Performance.</li>
      <ul>
        <li>High data throughput.</li>
      </ul>
    </ul>

    <h3 class="card-title">Estimation</h3>

    <h4 class="card-title">Server</h4>
    <ul>
      <li>Assume</li>
      <ul>
        <li>5M active users.</li>
        <li>A single server can handle 500 connections.</li>
      </ul>
      <li>5M / 500 = 10,000 servers are needed.</li>
    </ul>

    <h4 class="card-title">Storage</h4>
    <ul>
      <li>Assume</li>
      <ul>
        <li>250,000 videos per day.</li>
        <li>Each video is 50 MB.</li>
      </ul>
      <li>250,000 * 50 MB = 12.5TB per day.</li>
    </ul>

    <h4 class="card-title">Bandwidth</h4>
    <ul>
      <li>Assume</li>
      <ul>
        <li>Each user makes 20 requests.</li>
      </ul>
      <li>12.5 TB * 8 / 86400 = 1.16 Gbps</li>
      <li>5M * 20 * 50MB * 8 = 462.96 Gbps.</li>
    </ul>

    <h3 class="card-title">High level design</h3>

    <img class="img-fluid" class="card-img-top" src="/img/system-design/blob-store1.png" alt="Card image cap">
    <br>
    <br>

    <h3 class="card-title">API</h3>
    <ul>
      <li>create_container(container_name)</li>
      <li>put_blob(container_path, blob_bame, data)</li>
      <li>get_blob(blob_path)</li>
      <li>delete_blob(blob_path)</li>
      <li>list_blob(container_path)</li>
      <li>delete_container(container_path)</li>
      <li>list_containers(account_id)</li>
    </ul>

    <h3 class="card-title">Component design</h3>
    <ul>
      <li>Data nodes: hold the actual blob data.</li>
      <li>Master node: manages storage paths and access privileges of blobs.</li>
      <li>Monitoring service: monitors the data nodes and the master node.</li>
    </ul>
    <img class="img-fluid" class="card-img-top" src="/img/system-design/blob-store2.png" alt="Card image cap">
    <br>
    <br>
  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/deep-dive-into-system-design-interview">Deep Dive into System Design Interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-18">
  <div class="card-body">
    <h2 class="card-title">Distributed search</h2>
    <ul>
      <li>Crawler: fetches content and creates documents.</li>
      <li>Indexer: builds a searchable index.</li>
      <li>Searcher: responds to search queries by running the search query on the index created by the indexer..</li>
    </ul>

    <h3 class="card-title">Requirement</h3>

    <h4 class="card-title">Functional</h4>
    <ul>
      <li>User can search via queries.</li>
    </ul>

    <h4 class="card-title">Non-functional</h4>
    <ul>
      <li>Availability.</li>
      <li>Reliability.</li>
      <li>Scalability.</li>
      <li>Performance.</li>
      <ul>
        <li>Users should get result quickly.</li>
      </ul>
    </ul>

    <h3 class="card-title">Estimation</h3>

    <h4 class="card-title">Server</h4>
    <ul>
      <li>Assume</li>
      <ul>
        <li>3M daily active users.</li>
        <li>A single server can handle 1000 connections.</li>
      </ul>
      <li>3M / 1,000 = 3,000 servers are needed.</li>
    </ul>

    <h4 class="card-title">Storage</h4>
    <ul>
      <li>Assume</li>
      <ul>
        <li>Single JSON is 200 KB.</li>
        <li>The number of unique terms from each document is 1000.</li>
        <li>Each term is 100 bytes.</li>
        <li>6000 videos per day.</li>
      </ul>
      <li>One video: 200 KB * 1000 * 100 bytes = 300 KB.</li>
      <li>6000 * 300 KB = 1.8 GB per day.</li>
    </ul>

    <h4 class="card-title">Bandwidth</h4>
    <ul>
      <li>Assume</li>
      <ul>
        <li>150 M queries per day.</li>
        <li>Each query is 100 bytes.</li>
        <li>Response is 4000 bytes.</li>
      </ul>
      <li>Incoming: 150 M * 100 * 8 / 86400 = 1.39 Mbps</li>
      <li>Outgoing: 150 M * 4000 * 8 / 86400 = 55.56 Mbps</li>
    </ul>

    <h3 class="card-title">High level design</h3>

    <img class="img-fluid" class="card-img-top" src="/img/system-design/distributed-search1.png" alt="Card image cap">
    <br>
    <br>

    <h3 class="card-title">API</h3>
    <ul>
      <li>search(query)</li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/deep-dive-into-system-design-interview">Deep Dive into System Design Interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-19">
  <div class="card-body">
    <h2 class="card-title">Distributed task scheduler</h2>

    <h3 class="card-title">Requirement</h3>

    <h4 class="card-title">Functional</h4>
    <ul>
      <li>User can submit tasks.</li>
      <li>User can cancel submitted tasks.</li>
      <li>User can see task status.</li>
      <li>CPU and memory must be allocated efficiently.</li>
    </ul>

    <h4 class="card-title">Non-functional</h4>
    <ul>
      <li>Availability.</li>
      <li>Reliability.</li>
      <li>Scalability.</li>
      <li>Performance.</li>
    </ul>

    <h3 class="card-title">High level design</h3>

    <img class="img-fluid" class="card-img-top" src="/img/system-design/distributed-task-scheduler1.png" alt="Card image cap">
    <br>
    <br>

    <h3 class="card-title">Component design</h3>

    <img class="img-fluid" class="card-img-top" src="/img/system-design/distributed-task-scheduler2.png" alt="Card image cap">
    <br>
    <br>
  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/deep-dive-into-system-design-interview">Deep Dive into System Design Interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-20">
  <div class="card-body">
    <h2 class="card-title">Shared counter</h2>

  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/deep-dive-into-system-design-interview">Deep Dive into System Design Interview</a>
  </div>
</div>



































<div class="card mb-4" id="system-design-104">
  <div class="card-body">
    <h2 class="card-title">Entity linking</h2>

    <h3 class="card-title">Problem</h3>
    <ul>
      <li>Named entity recognition</li>
      <ul>
        <li>Detect person, organization, location, etc.</li>
      </ul>
      <li>Disambiguation</li>
      <ul>
        <li>Map each detected entity to corresponding entity in knowledge base.</li>
        <li>For example, "Michael Jordan is a machine learning professor at UC Berkeley."</li>
        <ul>
          <li>Michael Jordan linked to the professor at the University of California, Berkeley entity in the knowledge base.</li>
          <li>UC Berkeley is linked to the University of California entity in the knowledge base.</li>
        </ul>
      </ul>
    </ul>

    <h3 class="card-title">Requirement</h3>

    <h4 class="card-title">Training</h4>

    <h4 class="card-title">Inference</h4>

    <h3 class="card-title">Estimation</h3>

    <h3 class="card-title">Metric</h3>
    <ul>
      <li>There will be separate metric for each of three components</li>
      <ul>
        <li>Named entity recognition</li>
        <li>Disambiguation</li>
        <li>Entity linking as a whole</li>
      </ul>
    </ul>

    <h4 class="card-title">Named entity recognition (Offline)</h4>
    <ul>
      <li>Precision = number of correctly recognized named entities / number of total recognized named entitied</li>
      <li>Recall = number of correctly recognized named entities / number of named entities in corpus</li>
      <li>F1 score = \( 2 * \frac{PR}{P+R} \)</li>
    </ul>

    <h4 class="card-title">Disambiguation (Offline)</h4>
    <ul>
      <li>Recall doesn't make sense.</li>
      <li>Precision = number of mentions correctly linked / number of total mentions</li>
    </ul>

    <h4 class="card-title">Micro average (Offline)</h4>
    <ul>
      <li>Aggregates contributions of all documents to compute average.</li>
      <li>Precision = sum of TP / (sum of TP + sum of FP)</li>
      <li>Recall = sum of TP / (sum of TP + sum of FN)</li>
      <li>Micro-averaged F1-score = \( 2 * \frac{PR}{P+R} \)</li>
    </ul>

    <h4 class="card-title">Macro average (Offline)</h4>
    <ul>
      <li>Computes metrics independently for each document and takes the average.</li>
      <li>Precision = sum of Precision over documents / n</li>
      <li>Recall = sum of Recall over documents / n</li>
      <li>Macro-averaged F1-score = \( 2 * \frac{PR}{P+R} \)</li>
    </ul>

    <h3 class="card-title">Architecture</h3>
    <img class="img-fluid" class="card-img-top" src="/img/system-design/entity-linking1.png" alt="Card image cap">
    <br>
    <br>

    <h3 class="card-title">Training data generation</h3>
    <ul>
      <li>Named entity recognition</li>
      <ul>
        <li>CoNLL-2003</li>
      </ul>
      <li>Disambiguation</li>
      <ul>
        <li>AIDA CoNLL-YAGO Dataset</li>
      </ul>
    </ul>

    <h3 class="card-title">Modeling</h3>
    <ul>
      <li>Traditional word embedding like Word2vec does not understand the context.</li>
    </ul>

    <h4 class="card-title">ELMo (Embeddings from Language Models)</h4>
    <ul>
      <li>Starts with something like Word2vec.</li>
      <li>Raw vectors are fed into bidirectional LSTM layer.</li>
      <li>Forward and backward LSTMs are trained independently.</li>
      <li>Word representations cannot take advantage of left and right context simultaneously.</li>
    </ul>

    <h4 class="card-title">BERT (Bidirectional encoder representations from transformers)</h4>
    <ul>
      <li>Take input sentenses, which can be multiple sentences separated by SEP tag.</li>
      <li>Each word is converted to embedding and fed into transformer encoder layer.</li>
      <li>All words are processed simultaneously in the layer.</li>
      <li>Final transformer layer outputs the contextualized representation of each word.</li>
    </ul>

    <h4 class="card-title">NER modelling</h4>
    <ul>
      <li>Option 1. Use embeddings generated by BERT as features in NER modelling.</li>
      <li>Option 2. Take pre-trained models and fine-tune them based on NER dataset.</li>
    </ul>

    <h4 class="card-title">Disambiguation modeling</h4>

    <h5 class="card-title">Candidate generation</h5>
    <ul>
      <li>Build an index where terms are mapped to knowledge base entities.</li>
      <li>Index should include all terms that could possibly refer to an entity.</li>
    </ul>

    <h5 class="card-title">Linking</h5>
    <ul>
      <li>Build a model that gives the probability of a candidate being true match for a recognized entity.</li>
      <li>Inputs to this model should be represented by BERT/ELMo embeddings.</li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/become-a-machine-learning-engineer">Become a Machine Learning Engineer</a>
  </div>
</div>

<div class="card mb-4" id="system-design-105">
  <div class="card-body">
    <h2 class="card-title">Ad prediction</h2>
    <ul>
      <li>Predict the probability of user engagement with an AD given context (query, device, etc)</li>
    </ul>

    <h3 class="card-title">Requirement</h3>

    <h4 class="card-title">Training</h4>
    <ul>
      <li>Handle highly imbalanced data.</li>
      <li>Retrain models many times within one day.</li>
      <li>Training data and validation data is partitioned by time.</li>
    </ul>

    <h4 class="card-title">Inference</h4>
    <ul>
      <li>Low latency (50ms - 100ms) for ad prediction.</li>
      <li>Recommendation latency for ML model needs to be fast.</li>
    </ul>

    <h3 class="card-title">Estimation</h3>
    <ul>
      <li>100B ad requests per month.</li>
    </ul>

    <h4 class="card-title">Storage</h4>
    <ul>
      <li>Hundreds of features per data point and each row is 500 bytes.</li>
      <li>1B clicked ads.</li>
      <li>100 * 10^12 * 500 = 5 * 10^16 = 50PB.</li>
      <li>Use 1 week of data for training and use the next day for validation.</li>
    </ul>

    <h3 class="card-title">Metric</h3>

    <h4 class="card-title">Offline</h4>
    <ul>
      <li>AUC (Area under curve)</li>
      <ul>
        <li>Common metric for binary classification.</li>
        <li>Does not penalize how far off predicted score is from the actual label.</li>
        <li>Insensitive to well-calibrated probabilities.</li>
      </ul>
      <li>Log loss (Cross-entropy loss)</li>
      <ul>
        <li>Calibration sensitive metric.</li>
        <li>Captures what degree expected probabilities diverge from class label.</li>
        <li>Sensitive to background CTR.</li>
      </ul>
      <li>Normalized Cross-Entropy</li>
      <ul>
        <li>Predictive logloss divided by the cross-entropy of the background CTR.</li>
        <li>This way NCE is insensitive to background CTR.</li>
      </ul>
    </ul>

    <h4 class="card-title">Online</h4>
    <ul>
      <li>Revenue, which is the sum of winning bid value.</li>
      <ul>
        <li>If bid is 1 and user clicks the Ad, advertisement is charged 1.</li>
        <li>Advertiser is not charged unless users click the AD.</li>
      </ul>
      <li>Engagement.</li>
      <ul>
        <li>Click rate: ratio of user clicks to ads.</li>
        <li>Rate of particular action such as add to cart, purchase, etc.</li>
      </ul>
      <li>Counter metric</li>
      <ul>
        <li>Hide the AD.</li>
        <li>Never see the AD.</li>
        <li>Report AD as inappropriate.</li>
      </ul>
    </ul>

    <h3 class="card-title">Architecture</h3>
    <img class="img-fluid" class="card-img-top" src="/img/system-design/ad-prediction1.png" alt="Card image cap">
    <br>
    <br>
    <img class="img-fluid" class="card-img-top" src="/img/system-design/ad-prediction2.png" alt="Card image cap">
    <br>
    <br>

    <h4 class="card-title">Auction</h4>
    <ul>
      <li>AD rank score = (AD predicted score * bid)</li>
      <li>Cost per engagement = (AD rank of AD below / AD rank score) + 0.01</li>
      <li>AD will cost the minimum price that wins the auction.</li>
    </ul>

    <h4 class="card-title">When user issues a query</h4>
    <ul>
      <li>AD selection selects all ADs matching the targeting criteria and predict AD relevance score using simple model.</li>
      <li>AD selection also ranks the ADs and sends top ADs to AD prediction.</li>
      <li>AD prediction uses ML model to predict precisely calibrated score.</li>
      <li>AD auction uses bid and predicted score to pick the top most relevant ADs shown to users.</li>
    </ul>

    <h3 class="card-title">Feature engineering</h3>

    <h4 class="card-title">Ad</h4>
    <ul>
      <li>ad_id</li>
      <li>ad_content_raw_terms</li>
      <li>historical_engagement_rate</li>
      <ul>
        <li>ad_engagement_history_last_24_hrs</li>
        <li>ad_engagement_history_last_7_days</li>
      </ul>
      <li>ad_impression</li>
      <li>ad_negative_engagement_rate</li>
      <li>ad_embedding</li>
      <li>ad_age</li>
      <li>ad_bid</li>
    </ul>

    <h4 class="card-title">Advertiser</h4>
    <ul>
      <li>advertiser_domain</li>
      <li>historical_engagement_rate</li>
      <li>region_wise_engagement</li>
    </ul>

    <h4 class="card-title">User</h4>
    <ul>
      <li>user_previous_search_terms</li>
      <li>user_search_terms</li>
      <li>age</li>
      <li>gender</li>
      <li>language</li>
      <li>embedding_last_k_ads</li>
      <li>engagement_content_type</li>
      <li>engagement_days</li>
      <li>platform_time_spent</li>
      <li>region</li>
    </ul>

    <h4 class="card-title">Context</h4>
    <ul>
      <li>current_region</li>
      <li>time</li>
      <li>device</li>
      <ul>
        <li>screen_size</li>
      </ul>
    </ul>

    <h4 class="card-title">User-ad</h4>
    <ul>
      <li>embedding_similarity</li>
      <li>region_wise_engagement</li>
      <li>user_ad_category_histogram</li>
      <li>user_ad_subcategory_histogram</li>
      <li>user_gender_ad_histogram</li>
      <li>user_age_ad_histogram</li>
    </ul>

    <h4 class="card-title">User-advertiser</h4>
    <ul>
      <li>embedding_similarity</li>
      <li>user_gender_advertiser_histogram</li>
      <li>user_age_advertiser_histogram</li>
    </ul>

    <h3 class="card-title">Training data generation</h3>

    <h4 class="card-title">Positive</h4>
    <ul>
      <li>Clicks the AD.</li>
      <li>Add item to cart.</li>
    </ul>

    <h4 class="card-title">Negative</h4>
    <ul>
      <li>Ignore the AD.</li>
      <li>Negative feedback on AD.</li>
    </ul>

    <h4 class="card-title">Model recalibration</h4>
    <ul>
      <li>Downsample negative examples because it is likely that 98% of data would be negative.</li>
      <li>Recalibration is needed such that</li>
      <ul>
        <li>\( q = \frac{p}{p+\frac{1-p}{w}} \)</li>
        <li>q is re-calibrated prediction score.</li>
        <li>p is prediction in downsampling space.</li>
        <li>w is downsampling rate.</li>
      </ul>
    </ul>

    <h4 class="card-title">Train/test</h4>
    <ul>
      <li>Train on first two weeks of data and test on third week of data.</li>
    </ul>

    <h3 class="card-title">Ad selection</h3>

    <h4 class="card-title">1. Selection</h4>
    <ul>
      <li>Build an in-memory index.</li>
      <li>Issue a query to fetch all Ads that are targeted for the current user.</li>
      <ul>
        <li>Ex. Use search term, age, location, gender, etc to fetch the result.</li>
      </ul>
    </ul>

    <h4 class="card-title">2. Narrow down selection</h4>
    <ul>
      <li>Use (bid * prior cost per engagement score) to pick the top selections.</li>
      <ul>
        <li>If no prior score due to being new AD, give slightly higher score.</li>
      </ul>
    </ul>

    <h4 class="card-title">3. Rank using simple model</h4>
    <ul>
      <li>Select top K Ads from the result of the previous step.</li>
      <li>Use logistic regression or additive trees.</li>
      <li>At evaluation, Ads will be ranked basd on (bid * cost per engagement score)</li>
    </ul>

    <h3 class="card-title">Ad prediction</h3>

    <h4 class="card-title">Online learning</h4>
    <ul>
      <li>Refresh model with the latest impression and engagement at regular interval (15min, 30min, etc)</li>
      <ul>
        <li>Train base model and add new examples on top of it.</li>
        <li>Stochastic gradient descent is used.</li>
      </ul>
      <li>Generates the latest training examples using an online joiner.</li>
      <li>Training data generater takes those examples and generates right feature sets.</li>
      <li>Model trainer runs SGD with those examples.</li>
    </ul>

    <h4 class="card-title">Non-linear feature generation</h4>
    <ul>
      <li>Use additive trees and neural network to generate features.</li>
      <li>Use features from above in logistic regression.</li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    <a href="https://www.educative.io/path/become-a-machine-learning-engineer">Become a Machine Learning Engineer</a>
  </div>
</div>
<!-- System design END -->

</div> <!-- /.col-md-12 -->
</div> <!-- /.row -->
</div> <!-- /.container -->

<include src="/footer.html"></include>

</body>

</html>
<!DOCTYPE html>

<html lang="en">

<head>

<!-- Metadata -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="Seungmoon Rieh">
<meta name="keywords" content="">

<!-- Title and image -->
<title>Seungmoon Rieh</title>
<link href="/img/seungmoonrieh.jpg" rel="icon">

<!-- CSS -->
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/monokai-sublime.css" rel="stylesheet">
<link href="/css/site.css" rel="stylesheet">

<!-- JavaScript -->
<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/bootstrap.bundle.min.js" type="text/javascript"></script>
<script src="/js/highlight.pack.js" type="text/javascript"></script>
<script src="/js/include_html.js" type="text/javascript"></script>
<script src="/js/mathjax/tex-chtml.js" type="text/javascript"></script>
<script src="/js/site.js" type="text/javascript"></script>

</head>

<body>

<include src="/header.html"></include>

<div class="container">
<div class="row">
<div class="col-md-12">
<h1 class="my-4">Software Engineering</h1>

<!-- Software engineering and system design BEGIN -->
<div class="card mb-4" id="system-design">
  <div class="card-body">
    <h2 class="card-title">Software engineering and system design</h2>
    <!-- <ul class="list-unstyled mb-0"> -->
    <ul>
      <li>Structure</li>
      <ul>
        <li><a href="#system-design-">Requirement and estimation</a> - 5 minutes</li>
        <li><a href="#system-design-">Database</a> - 2 minutes</li>
        <li><a href="#system-design-">API</a> - 5 minutes</li>
        <li><a href="#system-design-">High-level design</a> - 10 minutes</li>
  <!--       <ul>
          <li><a href="#system-design-">DNS</a></li>
          <li><a href="#system-design-">CDN</a></li>
          <li><a href="#system-design-">Load balancer</a></li>
          <li><a href="#system-design-">Cache</a></li>
          <li><a href="#system-design-">Message queue</a></li>
        </ul> -->
        <li><a href="#system-design-">Detailed design</a> - 10 minutes</li>
  <!--       <ul>
          <li><a href="#system-design-">Distributed system</a></li>
          <li><a href="#system-design-">Deployment</a></li>
          <li><a href="#system-design-">Network</a></li>
          <li><a href="#system-design-">Security</a></li>
        </ul> -->
  <!--       <ul>
          <li><a href="#system-design-">Availability</a></li>
          <li><a href="#system-design-">Reliability</a></li>
          <li><a href="#system-design-">Scalability</a></li>
          <li><a href="#system-design-">Performance</a></li>
          <li><a href="#system-design-">Consistency</a></li>
        </ul> -->
      </ul>
      <li>Product design  <strong>(in-scope)</strong></li>
      <ul>
        <li>Design Instagram</li>
        <li>Design Amazon</li>
        <!-- <li><a href="/software-engineering/2.3-instagram.html">Design Instagram</a></li> -->
      </ul>
      <li>Infrastructure design (out-of-scope)</li>
      <ul>
        <li>Rate limiter</li>
        <li>Message broker</li>
        <li>Key-value store</li>
      </ul>
      <li>Object-oriented design (out-of-scope)</li>
      <ul>
        <li>Parking lot reservation system</li>
        <li>Vending machine</li>
        <li>Elevator control system</li>
      </ul>
      <li>Front-end design (out-of-scope)</li>
      <ul>
        <li>Design front-end of spreadsheet app</li>
        <li>Design front-end of video editor app</li>
      </ul>
      <li>Talking points</li>
      <ul>
        <li>Discuss trade-off and user experience</li>
        <ul>
          <li>Consider 2-3 solutions</li>
          <li>Justify chosen decision</li>
        </ul>
        <li>Describe components and their interactions</li>
        <li>Describe complete lifecycle of a request</li>
        <li>Discuss potential bottlenecks</li>
        <li>Dicusss future problems as system scales</li>
        <li>Describe failover</li>
        <li>Discuss user experience when failure happens</li>
        <li>Discuss peak load</li>
      </ul>
      <li>Communicate</li>
      <ul>
        <li>Do not jump into a solution</li>
        <li>Ask to clarify the requirement, make proper assumption, gather information to understand the scale and constraints</li>
        <ul>
          <li>What specific features are we building?</li>
          <li>How many users?</li>
          <li>How fast does the system scale? 3 months, 6 months, etc?</li>
          <li>What existing services are there to leaverage?</li>
        </ul>
        <li>Do a recap of design</li>
        <li>Be open to feedbacks</li>
      </ul>
    </ul>

    <h3 class="card-title">Design I</h3>
    <ul>
      <li><a href="/software-engineering/2.1-rate-limiter.html">Design rate limiter</a></li>
      <li><a href="/software-engineering/2.1-consistent-hashing.html">Design consistent hashing</a></li>
      <li><a href="/software-engineering/2.1-key-value-store.html">Design key-value store</a></li>
      <li><a href="/software-engineering/2.1-uuid-generator.html">Design UUID generator</a></li>
      <li><a href="/software-engineering/2.1-url-shortener.html">Design URL shortener</a></li>
      <li><a href="/software-engineering/2.1-web-crawler.html">Design web crawler</a></li>
      <li><a href="/software-engineering/2.1-notification-system.html">Design notification system</a></li>
      <li><a href="/software-engineering/2.1-newsfeed-system.html">Design newsfeed system</a></li>
      <li><a href="/software-engineering/2.1-chat-system.html">Design chat system</a></li>
      <li><a href="/software-engineering/2.1-search-autocomplete-system.html">Design search autocomplete system</a></li>
      <li><a href="/software-engineering/2.1-youtube.html">Design youtube</a></li>
      <li><a href="/software-engineering/2.1-google-drive.html">Design google drive</a></li>
    </ul>

    <h3 class="card-title">Design II</h3>
    <ul>
      <li>Design proximity service</li>
      <li>Design nearby friends</li>
      <li>Design google maps</li>
      <li>Design distributed message queue</li>
      <li>Design metrics monitoring and alerting system</li>
      <li>Design ad click event aggregation</li>
      <li>Design hotel reservation</li>
      <li>Design distributed email service</li>
      <li>Design simple storage service</li>
      <li>Design real-time gaming leaderboard</li>
      <li>Design payment system</li>
      <li>Design digital wallet</li>
      <li>Design stock exchange</li>
    </ul>

    <h3 class="card-title">Design data-Intensive application</h3>

    <h3 class="card-title">Hello interview</h3>
    <ul>
      <li>Design Bit.ly</li>
      <li>Design Dropbox</li>
      <li>Design a Local Delivery Service</li>
      <li>Design a News Aggregator</li>
      <li>Design Ticketmaster</li>
      <li>Design FB News Feed</li>
      <li>Design Tinder</li>
      <li>Design LeetCode</li>
      <li>Design WhatsApp</li>
      <li>Design Yelp</li>
      <li>Design Strava</li>
      <li>Design Online Auction</li>
      <li>Design FB Live Comments</li>
      <li>Design FB Post Search</li>
      <li>Design a Price Tracking Service</li>
      <li>Design Instagram</li>
      <li>Design YouTube Top K</li>
      <li>Design Uber</li>
      <li>Design Robinhood</li>
      <li>Design Google Docs</li>
      <li>Design YouTube</li>
      <li>Design Web Crawler</li>
      <li>Design Ad Click Aggregator</li>
      <li>Design a Payment System</li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: System Design Interview, Alex Xu | <a href="https://www.hellointerview.com">hello interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-">
  <div class="card-body">
    <h2 class="card-title">Requirement and estimation</h2>
    <ul>
      <li>Functional - prioritize top 3 requirements</li>
      <li>Non-functional - each requirement should have target numbers</li>
    </ul>

    <h3 class="card-title">Web servers</h3>
    <ul>
      <li>Typically serve static content to client (Web browser)</li>
      <li>Usually handle API calls from clients</li>
    </ul>

    <h3 class="card-title">App servers</h3>
    <ul>
      <li>Typically serve dynamic content to client</li>
      <li>Core business logic</li>
    </ul>

    <h3 class="card-title">Important latencies (in nanoseconds)</h3>
    <table>
      <tr>
        <td>L1 cache reference</td>
        <td>0.9</td>
      </tr>
      <tr>
        <td>L2 cache reference</td>
        <td>2.8</td>
      </tr>
      <tr>
        <td>L3 cache reference</td>
        <td>12.9</td>
      </tr>
      <tr>
        <td>Main memory reference</td>
        <td>100</td>
      </tr>
      <tr>
        <td>Compress 1KB with Snzip</td>
        <td>3,000 (3 microseconds)</td>
      </tr>
      <tr>
        <td>Read 1 MB sequentially from memory</td>
        <td>9,000 (9 microseconds)</td>
      </tr>
      <tr>
        <td>Read 1 MB sequentially from SSD</td>
        <td>200,000 (200 microseconds)</td>
      </tr>
      <tr>
        <td>Round trip within same datacenter</td>
        <td>500,000 (500 microseconds)</td>
      </tr>
      <tr>
        <td>Read 1 MB sequentially from SSD with speed ~1GB/sec SSD</td>
        <td>1,000,000 (1 milliseconds)</td>
      </tr>
      <tr>
        <td>Disk seek</td>
        <td>4,000,000 (4 milliseconds)</td>
      </tr>
      <tr>
        <td>Read 1 MB sequentially from disk</td>
        <td>2,000,000 (2 milliseconds)</td>
      </tr>
      <tr>
        <td>Send packet SF->NYC</td>
        <td>71,000,000 (71 milliseconds)</td>
      </tr>
    </table>

    <h3 class="card-title">Important rates</h3>
    <table>
      <tr>
        <td>QPS handled by MySQL</td>
        <td>1000</td>
      </tr>
      <tr>
        <td>QPS handled by key-value store</td>
        <td>10,000</td>
      </tr>
      <tr>
        <td>QPS handled by cache server</td>
        <td>100,000â€“1 M</td>
      </tr>
    </table>

    <h3 class="card-title">Availability numbers</h3>
    <table>
      <tr>
        <th>Availability</th>
        <th>Downtime per day</th>
        <th>Downtime per year</th>
      </tr>
      <tr>
        <td>99%</td>
        <td>14.40 minutes</td>
        <td>3.65 days</td>
      </tr>
      <tr>
        <td>99.9%</td>
        <td>1.44 minutes</td>
        <td>8.77 hours</td>
      </tr>
      <tr>
        <td>99.99%</td>
        <td>8.64 seconds</td>
        <td>52.6 minutes</td>
      </tr>
      <tr>
        <td>99.99%</td>
        <td>0.864 seconds</td>
        <td>5.26 minutes</td>
      </tr>
      <tr>
        <td>99.99%</td>
        <td>0.0864 seconds</td>
        <td>31.56 seconds</td>
      </tr>
    </table>

    <h3 class="card-title">Request per second</h3>
    <ul>
      <li>Assume</li>
      <ul>
        <li>Server has 36 cores (72 threads), 256GB RAM</li>
        <li>OS and other processes consumed 16GB RAM</li>
        <li>Each worker consumes 300MB RAM to complte a request</li>
        <li>Each CPU-bound request takes 200 millisecond</li>
        <li>Each memory-bound request takes 50 milliseconds</li>
      </ul>
      <li>RPS (CPU) = number of thread / time each task takes = 72 / 200ms = 360 RPS</li>
      <li>RPS (RAM) = Available memory / (time each task takes * worker memory comsumption) = 240GB / (50ms * 300MB)= 16,000 RPS</li>
      <li>Assume half requests are CPU bound and half requests are memory bound: 360 / 2 + 16,000 / 2 = 8,000 RPS</li>
    </ul>

    <h3 class="card-title">Estimate number of servers</h3>
    <ul>
      <li>Assume 500M daily users and 20 request per day on average</li>
      <ul>
        <li>Then, it is 500M * 20 = 10B requests per day, which is 115K requests per seconds (RPS)</li>
        <li>But if all users make a request at the same time, it is 500M * 1 = 500M requests per second (RPS)</li>
      </ul>
      <li>Assume a server can handle 8,000 RPS</li>
      <ul>
        <li>It looks like 15 servers can handle 500M users if load is evenly spread throughout the day</li>
        <li>However, at the peak, 500M / 8,000 = 62,000 servers are needed</li>
      </ul>
    </ul>

    <h3 class="card-title">Estimate storage</h3>
    <ul>
      <li>Assume 250M daily active users and each user makes 3 write requests per day</li>
      <li>Assume 10% contains images, 5% contains videos, 85% contain just text</li>
      <li>Assume each image is 200KB, video is 3MB, and text is 250 bytes</li>
      <li>Storage required - (250M * 3) * (0.1 * 200KB + 0.05 * 3MB + 0.85 * 250 bytes) = 128MB per day</li>
    </ul>

    <h3 class="card-title">Estimate bandwitdth</h3>
    <ul>
      <li>Incoming traffic - (128 MB per day / 86400 seconds per day) * 8 bits per byte = 11.8Kbps</li>
      <li>Assume each user make 50 read requests per day</li>
      <li>Outgoing traffic - (12Kbps / 3) * 50 = 197.5Kbps</li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: System Design Interview, Alex Xu | <a href="https://www.educative.io/path/deep-dive-into-system-design-interview">Deep Dive into System Design Interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-">
  <div class="card-body">
    <h2 class="card-title">Database</h2>
    <ul>
      <li>Relational</li>
      <ul>
        <li>Need strong consistency</li>
        <li>Normalization</li>
        <ul>
          <li>Split data across tables to avoid duplicate</li>
          <li>Joins are needed to get complete data</li>
          <li>Normalization by default and only de-normalize for specific hot path</li>
        </ul>
        <li>De-normalization</li>
        <ul>
          <li>Avoid joins to make read faster</li>
          <li>Updates are expensive</li>
        </ul>
      </ul>
      <li>NoSQL</li>
      <ul>
        <li>Schema changes often</li>
        <li>Need to know common queries upfront and design accordingly</li>
      </ul>
      <li>Index</li>
      <ul>
        <li>Sort data to make read faster</li>
        <li>DB index</li>
        <ul>
          <li>B-tree - exact lookups and ranged queries</li>
          <li>Hash index - specialized for exact lookups</li>
        </ul>
        <li>External system</li>
        <ul>
          <li>Elasticsearch - full-text search</li>
        </ul>
      </ul>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: <a href="https://www.hellointerview.com">hello interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-">
  <div class="card-body">
    <h2 class="card-title">API</h2>
    <ul>
      <li>Communication protocol</li>
      <ul>
        <li>REST</li>
        <ul>
          <li>Ex. <code>/users/{id}</code> - get a user</li>
          <li>Ex. <code>/events/{id}/bookings</code> - create a booking</li>
        </ul>
        <li>GraphQL</li>
        <ul>
          <li>Request exactly the fields clients need in a single query</li>
          <li>Address under-fetching/over-fetching issue</li>
          <li>Add complexitiy to backend like query parsing, schema validation, N+1 query problem</li>
        </ul>
        <li>gRPC</li>
        <ul>
          <li>Common pattern is REST for external APIs and gRPC for internal microservice communication</li>
        </ul>
      </ul>
      <li>Authentication</li>
      <ul>
        <li>JWT tokens for user sessions</li>
        <li>API keys for service-to-service calls</li>
      </ul>
      <li>Rate limiting</li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: <a href="https://www.hellointerview.com">hello interview</a>
  </div>
</div>

<div class="card mb-4" id="system-design-">
  <div class="card-body">
    <h2 class="card-title">High-level design</h2>
  </div>
  <div class="card-footer text-muted">
    Reference: System Design Interview, Alex Xu
  </div>
</div>

<div class="card mb-4" id="system-design-">
  <div class="card-body">
    <h2 class="card-title">Detailed design</h2>
    <ul>
      <li>Deployment</li>
      <ul>
        <li>Blue-Green</li>
        <ul>
          <li>Existing production instance is <strong>Blue</strong></li>
          <li>Deploy new instance <strong>Green</strong></li>
          <li>Run tests on <strong>Green</strong> instance</li>
          <li>Make <strong>Green</strong> the production instance</li>
          <ul>
            <li>Re-map DNS to <strong>Green</strong>'s IP address</li>
            <li>Remove <strong>Blue</strong> from load-balancer and add <strong>Green</strong></li>
          </ul>
        </ul>
        <li>Carnary</li>
        <ul>
          <li>Similar to Blue-Green but redirect only subset of users instead of all users</li>
          <ul>
            <li>Choose users who are more active, etc</li>
          </ul>
          <li>Both <strong>Blue</strong> and <strong>Green</strong> would be up during this time</li>
          <li>Great way to do capacity testing on new instance</li>
          <ul>
            <li>Can always roll-back by redirecting users to old instance</li>
          </ul>
          <li>Managing multiple versions of software is required</li>
        </ul>
        <li>Dark-launching</li>
        <ul>
          <li>Releasing production-ready features to subset of users prior to full release</li>
          <li>Feature toggle - run specific part of code based on configuration stored online</li>
          <li>Turn on features only for subset of users before releasing features to everybody</li>
        </ul>
        <li>Edge deployment</li>
        <ul>
          <li>Client data is analyzed as close to the source as possible</li>
        </ul>
      </ul>
      <li>Network</li>
      <ul>
        <li>Communication protocol</li>
        <ul>
          <li>HTTP (REST)</li>
          <ul>
            <li>Used 90% of time</li>
            <li>Used for external API</li>
          </ul>
          <li>Server-Sent Events</li>
          <ul>
            <li>Bidirectional communication</li>
            <li>Stateful connection (can't simply put it in load-balancer)</li>
            <li>Ex. chat</li>
          </ul>
          <li>WebSockets</li>
          <ul>
            <li>Check that HTTP with long-polling or SSE work first before considering WebSockets</li>
            <li>Server-to-client push only</li>
            <li>Stateful connection (can't simply put it in load-balancer)</li>
            <li>Typically need Layer 4 balancing for maintaining persistent TCP connection</li>
            <li>Ex. notification</li>
          </ul>
          <li>gRPC</li>
          <ul>
            <li>Uses binary serialization and HTTP/2 (Faster than JSON used by HTTP)</li>
            <li>Browser support is limited</li>
            <li>Used for internal service-to-service communication</li>
          </ul>
        </ul>
        <li>Load balancer</li>
        <ul>
          <li>Layer 7</li>
          <ul>
            <li>Operate at application level</li>
            <li>Route based on HTTP request content</li>
          </ul>
          <li>Layer 4</li>
          <ul>
            <li>Operate at TCP level</li>
            <li>Distribute connections without looking at content</li>
          </ul>
        </ul>
      </ul>
      <li>Caching</li>
      <ul>
        <li>Only needed when read-heavy and data does not change frequently</li>
        <li>Use cash-aside with Redis 90% of time</li>
        <ul>
          <li>If data in cache, return it</li>
          <li>Else, query DB and put it in cache with TTL. Then, return it</li>
        </ul>
        <li>Invalidate cache</li>
        <ul>
          <li>Option 1. update cache immediate after DB is updated by write</li>
          <li>Option 2. short TTL</li>
        </ul>
        <li>Cache failure</li>
        <ul>
          <li>Option 1. built in-process cache as fallback</li>
        </ul>
        <li>CDN</li>
        <ul>
          <li>JS files, images, videos are served from edge location close to uers</li>
        </ul>
      </ul>
      <li>Sharding</li>
      <ul>
        <li>Only when a single database is not sufficient</li>
        <ul>
          <li>Single DB with read replica is enough for 10K writes per second and 100GB of data</li>
        </ul>
        <li>Shard key is most important</li>
        <li>Consistent hashing</li>
        <ul>
          <li>Memcached and Redis Cluster uses it to distribute keys across cache nodes</li>
          <li>Cassandra and DynamoDB use it for sharding</li>
          <li>CDNs use it to route requests to edge servers</li>
        </ul>
      </ul>
      <li>CAP</li>
      <ul>
        <li>Choose availability with eventual consistency by default</li>
        <li>Choose consistency for Banking, Booking system</li>
      </ul>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: System Design Interview, Alex Xu | <a href="https://www.hellointerview.com">hello interview</a>
  </div>
</div>
<!-- Software engineering and system design END -->

</div> <!-- /.col-md-12 -->
</div> <!-- /.row -->
</div> <!-- /.container -->

<include src="/footer.html"></include>

</body>

</html>
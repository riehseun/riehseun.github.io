<!DOCTYPE html>

<html lang="en">

<head>

<!-- Metadata -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="Seungmoon Rieh">
<meta name="keywords" content="">

<!-- Title and image -->
<title>Seungmoon Rieh</title>
<link href="/img/seungmoonrieh.jpg" rel="icon">

<!-- CSS -->
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/monokai-sublime.css" rel="stylesheet">
<link href="/css/site.css" rel="stylesheet">

<!-- JavaScript -->
<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/bootstrap.bundle.min.js" type="text/javascript"></script>
<script src="/js/highlight.pack.js" type="text/javascript"></script>
<script src="/js/include_html.js" type="text/javascript"></script>
<script src="/js/mathjax/tex-chtml.js" type="text/javascript"></script>
<script src="/js/site.js" type="text/javascript"></script>

</head>

<body>

<include src="/header.html"></include>

<div class="container">
<div class="row">
<div class="col-md-12">
<h1 class="my-4">Software Engineering</h1>

<!-- Google Maps BEGIN -->
<div class="card mb-4" id="google-maps">
  <div class="card-body">
    <h2 class="card-title">Google Maps</h2>
    <ul class="list-unstyled mb-0">
      <li><a href="#google-maps-1">Understand the Problem and Establish Design Scope</a></li>
      <li><a href="#google-maps-2">Propose High-level Diagram and Get Buy-in</a></li>
      <li><a href="#google-maps-3">Design Deep Dive</a></li>
      <li><a href="#google-maps-4">Wrap Up</a></li>
    </ul>
  </div>
</div>

<div class="card mb-4" id="google-maps-1">
  <div class="card-body">
    <h2 class="card-title">Understand the Problem and Establish Design Scope</h2>
    <ul>
      <li>How many total users in the system? 1B</li>
      <li>How many daily users in the system? 100M</li>
      <li>What is the main function of the system? Location update, navigation, ETA, map rendering</li>
      <li>What is the size of road data? terrabytes</li>
      <li>Should the system consider traffic conditions? Yes</li>
      <li>Should the system support different travel mode like driving, walking, public transit? Yes</li>
      <li>Should the system support multi-stop directions? No</li>
      <li>Should the system support business photos and videos? No</li>
      <li>Should the system show the route as user moves? Yes</li>
      <li>Should the system show new route when user deviates from the path? Yes</li>
    </ul>

    <h3 class="card-title">Storage</h3>
    <ul>
      <li>Map tiling</li>
      <ul>
        <li>Geo coding</li>
        <ul>
          <li>Convert each address to a pair of latitude and longitude</li>
        </ul>
        <li>Geo hashing</li>
        <ul>
          <li>Encode geographical area with digits</li>
          <li>Each geographical area is considered as a tile</li>
        </ul>
      </ul>
      <li>Map rendering</li>
      <ul>
        <li>Clients only download relevant tiles for the area</li>
      </ul>
      <li>Metadata - negligible</li>
      <li>Road info - assume terrabytes</li>
      <li>World map</li>
      <ul>
        <li>At zoom level 21, there are 2^21 = 4.3 trillion tiles</li>
        <li>Assume each 256 by 265 tile image is 100KB</li>
        <li>Then, higest zoom level would have 430PB</li>
        <li>Assume 90% of world surfaces are ocean, desert, mountains, etc</li>
        <li>Then, 430PB * 0.1 = 43PB</li>
        <li>The subsequent zoom level would have \( 43 + \dfrac{43}{4} + \dfrac{43}{16} + \dfrac{43}{64} + \dots \) = ? PB</li>
      </ul>
    </ul>

    <h3 class="card-title">Bandwidth</h3>
    <ul>
      <li>Assume</li>
      <ul>
        <li>Assume each user uses navigation 1 hour per day</li>
        <li>Then, 100M * 1hr = 100M hours per day = 360B seconds per day</li>
        <li>Assume each GPS update is sent every 10 seconds on average</li>
        <li>Then, 360B / 10 = 36B GPS updates per day</li>
        <li>Assume both request and response is 100 bytes</li>
      </ul>
      <li>Incoming/Outgoing - 36B * 100 bytes * 8 / 86400 = ? bps</li>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: System Design Interview Volume 2, Alex Xu & Sahn Lam
  </div>
</div>

<div class="card mb-4" id="google-maps-2">
  <div class="card-body">
    <h2 class="card-title">Propose High-level Diagram and Get Buy-in</h2>
    <ul>
      <img class="img-fluid" class="card-img-top" src="/system-design/image/ref-sd-2/google-maps-1.png" alt="Card image cap">
      <li>Location service</li>
      <ul>
        <li>Client sends its location every second</li>
        <li>Location updates can be buffered on the client and send to the server as a batch every 10-15 seconds</li>
      </ul>
      <li>Navigation service</li>
      <ul>
        <li>Find route between two points</li>
        <li>Runs shortest path algorithm</li>
        <li>Shows the path on the map for the user</li>
        <li>Sends updated directions when user deviates from the path</li>
      </ul>
      <li>Map rendering</li>
      <ul>
        <li>User fetches new map tile from the server when</li>
        <ul>
          <li>User is zooming on the map</li>
          <li>During navigation when user moves out from current tile and moves to nearby tile</li>
        </ul>
        <li>Map tiles are pre-computed at various zoom level</li>
        <ul>
          <li>Each map tile is represented by its geohash</li>
        </ul>
        <li>CDN serves as a cache of map tiles</li>
        <li>Map tile service takes user location and zoom level as inputs and return 9 URLs of tiles</li>
        <ul>
          <li>Return value includes the tile to render and 8 surrounding tiles</li>
        </ul>
        <li>User downloads the tiles from CDN</li>
      </ul>
      <li>API</li>
      <ul>
        <li><code>curr_location(location)</code></li>
        <ul>
          <li>Display current location of user on the map</li>
          <li><code>location</code></li>
          <ul>
            <li>Boolean to indicate if user location is turned on or off</li>
            <li>If off, the service will ask user to turn on the location</li>
          </ul>
        </ul>
        <li><code>find_route(start, end, transport_type)</code></li>
        <ul>
          <li>Computes optimal route between two points</li>
          <li><code>start</code></li>
          <ul>
            <li>Start point in text format</li>
          </ul>
          <li><code>end</code></li>
          <ul>
            <li>Start point in text format</li>
          </ul>
        </ul>
        <li><code>directions(curr_location, steps)</code></li>
        <ul>
          <li>Provides alerts of when and where to make turns</li>
        </ul>
      </ul>
      <li>Database</li>
      <ul>
        <li>Road info</li>
        <ul>
          <li>Graph data is represented as adjacency list</li>
          <li>Serialize adjacency lists into binary files</li>
          <li>Use S3 to store data and cache it on the servers</li>
        </ul>
        <li>User location data</li>
        <ul>
          <li>Use Cassandra for write-heavy workload and availability over consistency</li>
          <ul>Schema</ul>
          <ul>
            <li>Key - (user_id, timestamp)</li>
            <li>Value - (latitude, longitude)</li>
          </ul>
        </ul>
        <li>Geocoding DB</li>
        <ul>
          <li>Use Redis for read-heavy workload</li>
          <ul>Schema</ul>
          <ul>
            <li>place_id</li>
            <li>location</li>
          </ul>
        </ul>
        <li>World map</li>
        <ul>
          <li>Use S3 and cache it on CDN</li>
        </ul>
      </ul>
    </ul>    
  </div>
  <div class="card-footer text-muted">
    Reference: System Design Interview Volume 2, Alex Xu & Sahn Lam
  </div>
</div>

<div class="card mb-4" id="google-maps-6">
  <div class="card-body">
    <h2 class="card-title">Design Deep Dive</h2>
    <ul>
      <li>Location service</li>
      <ul>
        <li>Other services consume location data from Kafka</li>
      </ul>
      <li>Map rendering</li>
      <ul>
        <li>WebGL - instead of sending images over network, send vectors (paths and polygons)</li>
        <li>Compressed vector data is much smaller than compressed images</li>
        <li>Zooming experience is much better with vectors</li>
      </ul>
      <li>Navigation service</li>
      <ul>
        <li>Geocoding service</li>
        <ul>
          <li>Converts location name to lat/long pair</li>
        </ul>
        <li>Routing planner service</li>
        <ul>
          <li>Computes suggested routes using other services</li>
        </ul>
        <li>Shortest path service</li>
        <ul>
          <li>Returns top k shortest paths without considering traffic or current conditions</li>
        </ul>
        <li>ETA service</li>
        <ul>
          <li>Computes ETA for each route using ML from current traffic and historical data</li>
        </ul>
        <li>Ranker</li>
        <ul>
          <li>Applies filters defined by user like avoid tolls or highways</li>
        </ul>
        <li>Traffic update service</li>
        <ul>
          <li>Updates traffic DB so that ETA service can compute accurate estimates</li>
        </ul>
      </ul>
    </ul>
  </div>
  <div class="card-footer text-muted">
    Reference: System Design Interview Volume 2, Alex Xu & Sahn Lam
  </div>
</div>

<div class="card mb-4" id="google-maps-7">
  <div class="card-body">
    <h2 class="card-title">Wrap Up</h2>
  </div>
  <div class="card-footer text-muted">
    Reference: System Design Interview Volume 2, Alex Xu & Sahn Lam
  </div>
</div>
<!-- Google Maps END -->

</div> <!-- /.col-md-12 -->
</div> <!-- /.row -->
</div> <!-- /.container -->

<include src="/footer.html"></include>

</body>

</html>